# =============================================================================
# VE3 TOOL - PROMPTS CONFIGURATION v2.0 (ENHANCED)
# =============================================================================
# Phiên bản nâng cấp với các kỹ thuật chuyên nghiệp:
# - Context Injection (Anti-hallucination)
# - Outfit Consistency Lock
# - Lighting Override Protocol
# - Spatial Positioning
# - Safety Rules cho trẻ em
# - Negative Prompts
# =============================================================================

# =============================================================================
# PHẦN 1: GLOBAL STYLE DEFINITIONS (QUAN TRỌNG - DÙNG CHO MỌI SCENE)
# =============================================================================

global_style: |
  Cinematic 4K photorealistic, shot on Arri Alexa Mini LF,
  shallow depth of field, soft film grain, natural color grading,
  high dynamic range, balanced exposure, professional lighting,
  sharp focus on subject, no crushing shadows, highly detailed textures.

global_lighting: |
  Face illuminated by soft volumetric light, clear facial features,
  high visibility, catch light in eyes, subtle rim lighting for depth separation.

negative_prompt_base: |
  cartoon, 3d render, anime, illustration, painting, drawing,
  text, watermark, logo, signature, bad anatomy, distorted face,
  mutation, deformed, ugly, blurry, low resolution, overexposed,
  underexposed, very dark image, heavy shadows, obscured face,
  extra limbs, missing limbs, floating limbs, disconnected limbs,
  duplicate characters, clone, disfigured, gross proportions.

# =============================================================================
# PHẦN 2: PROMPT PHÂN TÍCH NHÂN VẬT (NÂNG CẤP)
# =============================================================================
# Variables: {story_text}
# =============================================================================

analyze_story: |
  Bạn là AI Production Director chuyên phân tích kịch bản và tạo Character Reference cho AI image/video generation.

  ## INPUT - NỘI DUNG CÂU CHUYỆN:
  ---
  {story_text}
  ---

  ## NHIỆM VỤ CHÍNH:

  ### BƯỚC 1: PHÂN TÍCH BỐI CẢNH TOÀN CỤC
  Xác định và tạo [CONTEXT_LOCK] - chuỗi mô tả setting cố định:
  - Địa điểm chính (Interior/Exterior, loại không gian)
  - Thời gian trong ngày (Morning/Afternoon/Evening/Night)
  - Thời tiết/Ánh sáng môi trường
  - Thời đại/Phong cách (Modern/Vintage/Rural/Urban)

  ### BƯỚC 2: PHÂN TÍCH NHÂN VẬT

  **Quy tắc ID:**
  - Nhân vật chính (narrator/main): ID = "nvc"
  - Nhân vật phụ: ID = "nvp1", "nvp2", ... (tối đa 5)

  **Với MỖI nhân vật, tạo:**

  A) **PORTRAIT PROMPT** (để gen ảnh reference):
  Cấu trúc BẮT BUỘC theo thứ tự:
  ```
  (Shot type) + (Lens) + (Subject description) + (Face features) + (Hair) + (Skin) + (Expression) + (Lighting) + (Background) + (Technical)
  ```

  B) **[OUTFIT_LOCK]** - Mô tả trang phục cố định:
  ```
  wearing [chi tiết quần áo], [phụ kiện], [màu sắc cụ thể]
  ```

  C) **[CHARACTER_LOCK]** - Chuỗi mô tả ngắn để paste vào mọi scene:
  ```
  [Tuổi]-year-old [ethnicity] [gender] with [hair], [face features], [outfit lock]
  ```

  ### BƯỚC 3: XÁC ĐỊNH KEY OBJECTS (nếu có)
  Các vật thể quan trọng xuất hiện nhiều lần (xe, nhà, đồ vật đặc biệt...)

  ## QUY TẮC AN TOÀN (BẮT BUỘC):

  **Nếu nhân vật là TRẺ EM (< 14 tuổi):**
  - KHÔNG tạo portrait prompt chi tiết cho khuôn mặt
  - Thay bằng [CHILD_TEXT_LOCK]: "a [age]-year-old [ethnicity] child with [hair color] [hair style], wearing [outfit]"
  - Đánh dấu: "is_child": true

  ## OUTPUT FORMAT - JSON:

  {{
    "context_lock": "Interior modern suburban house, daytime, soft natural window light, contemporary American setting",

    "characters": [
      {{
        "id": "nvc",
        "role": "main",
        "name": "Tên trong truyện",
        "is_child": false,
        "age_range": "30-35",
        "gender": "female",

        "portrait_prompt": "Cinematic portrait, straight-on medium close-up, 85mm f/1.8 lens. Subject is a 32-year-old Caucasian woman with long wavy chestnut brown hair, oval face, soft green eyes with subtle crow's feet, natural pink lips, fair skin with light freckles on cheeks. Expression is neutral and calm, looking directly at camera. Face illuminated by soft diffused studio light, catch light in eyes. Clean neutral gray background. 8K, sharp focus, high fidelity portraiture, photorealistic.",

        "outfit_lock": "wearing a cream-colored knit cardigan over a white cotton blouse, simple gold pendant necklace",

        "character_lock": "32-year-old Caucasian woman with long wavy chestnut brown hair, oval face, soft green eyes, wearing a cream-colored knit cardigan over a white cotton blouse, simple gold pendant necklace",

        "vietnamese_description": "Phụ nữ 32 tuổi, tóc nâu hạt dẻ dài gợn sóng, mắt xanh lá dịu dàng, mặc cardigan kem và áo sơ mi trắng"
      }},
      {{
        "id": "nvp1",
        "role": "supporting",
        "name": "Tên nhân vật phụ",
        "is_child": true,
        "age_range": "7-8",
        "gender": "female",

        "portrait_prompt": "DO_NOT_GENERATE",

        "child_text_lock": "a 7-year-old Caucasian girl with blonde pigtails tied with pink ribbons, wearing a light blue summer dress with white polka dots and white sneakers",

        "outfit_lock": "wearing a light blue summer dress with white polka dots and white sneakers",

        "character_lock": "USE_CHILD_TEXT_LOCK",

        "vietnamese_description": "Bé gái 7 tuổi, tóc vàng buộc 2 bím với nơ hồng, váy xanh chấm bi trắng"
      }}
    ],

    "key_objects": [
      {{
        "id": "obj1",
        "name": "family photo frame",
        "prompt": "Extreme close-up macro shot, 100mm lens. A weathered wooden photo frame, 5x7 inches, containing a faded family photograph. Scratches and wear marks visible on the frame edges. Soft warm lighting from the left. Shallow depth of field. 8K detail, photorealistic."
      }}
    ]
  }}

  ## LƯU Ý QUAN TRỌNG:
  - portrait_prompt phải ĐỦ CHI TIẾT để AI tạo ảnh nhất quán qua nhiều lần gen
  - Luôn specify: lens, lighting, angle, background
  - Ethnicity mặc định: Caucasian/White (trừ khi truyện chỉ định khác)
  - Chỉ trả về JSON thuần, không có markdown code block hay text giải thích

# =============================================================================
# PHẦN 3: PROMPT TẠO SCENE (NÂNG CẤP TOÀN DIỆN)
# =============================================================================
# Variables: {characters_info}, {scenes_info}, {context_lock}, {global_style}
# =============================================================================

generate_scenes: |
  Bạn là AI Production Director chuyên tạo cinematic prompts cho AI image-to-video generation (Veo 3).

  ## GLOBAL VARIABLES (PASTE VÀO MỌI SCENE):

  **[CONTEXT_LOCK]:** {context_lock}

  **[GLOBAL_STYLE]:** {global_style}

  **[LIGHTING_PROTOCOL]:** Face illuminated by soft volumetric light, clear facial features, high visibility, catch light in eyes.

  ## THÔNG TIN NHÂN VẬT ĐÃ ĐỊNH NGHĨA:
  {characters_info}

  ## DANH SÁCH SCENE CẦN TẠO PROMPT:
  {scenes_info}

  ---

  ## NGUYÊN TẮC BẮT BUỘC:

  ### 1. GOLDEN RULE - 1:1 CONSISTENCY
  - 1 Scene Input = 1 Scene Output (KHÔNG gộp, KHÔNG tách)

  ### 2. PROMPT STRUCTURE (THEO THỨ TỰ NÀY):
  ```
  (Camera angle + Lens) → (Character với outfit_lock) → (Lighting Protocol) → (Action/Pose) → (Context Lock) → (Global Style)
  ```

  ### 3. SPATIAL POSITIONING (nếu có 2+ nhân vật):
  - Phải mô tả VỊ TRÍ TƯƠNG ĐỐI: "on the left", "in the foreground", "behind", "facing each other"
  - Phải nêu SỐ LƯỢNG: "Two people in frame", "Three figures visible"

  ### 4. CAMERA ANGLES (chọn phù hợp với cảm xúc):
  - Eye-level: Neutral, conversational
  - Low angle: Power, dominance, heroic
  - High angle: Vulnerability, weakness
  - Dutch tilt: Tension, unease
  - Over-the-shoulder (OTS): Conversation, connection

  ### 5. SHOT TYPES:
  - Extreme Close-up (ECU): Eyes, hands, objects - Emotion focus
  - Close-up (CU): Face - Emotion, reaction
  - Medium Close-up (MCU): Head + shoulders - Dialogue
  - Medium Shot (MS): Waist up - Action + context
  - Full Shot (FS): Entire body - Movement, location
  - Wide Shot (WS): Environment dominant - Establishing

  ### 6. SAFETY RULES CHO TRẺ EM:
  Nếu scene có trẻ em trong tình huống tiêu cực (sợ hãi, khóc, đau):
  - KHÔNG mô tả khuôn mặt trực tiếp
  - Thay bằng SAFE SHOTS:
    * "Shot from behind, showing the back of the child's head"
    * "Over-the-shoulder view from behind the child"
    * "Close-up on small hands gripping [object]"
    * "POV shot from the child's perspective looking up at [adult]"

  ### 7. AUTO-SPLIT CHO HÀNH ĐỘNG PHỨC TẠP:
  Nếu scene có hành động cause-effect (đánh, ngã, ném...):
  - Tách thành 2 prompts riêng trong cùng scene_id
  - Part A: Hành động khởi đầu
  - Part B: Kết quả/Phản ứng

  ---

  ## OUTPUT FORMAT - JSON:

  {{
    "scenes": [
      {{
        "scene_id": 1,
        "scene_type": "NARRATIVE",
        "characters_in_scene": ["nvc"],
        "reference_files": ["nvc.png"],

        "img_prompt": "Eye-level medium close-up, 50mm lens. A 32-year-old Caucasian woman with long wavy chestnut brown hair, oval face, soft green eyes, wearing a cream-colored knit cardigan over a white cotton blouse, simple gold pendant necklace. Face illuminated by soft volumetric light, clear facial features, catch light in eyes. She gazes out the window with a wistful expression, one hand touching the glass. Interior modern suburban house, daytime, soft natural window light filtering through sheer curtains, contemporary American setting. Cinematic 4K photorealistic, shot on Arri Alexa Mini LF, shallow depth of field, soft film grain, natural color grading, high dynamic range.",

        "video_prompt": "Gentle slow push-in camera movement toward the woman's face. She slowly turns her head from the window to look toward camera. Her expression shifts from contemplative to slightly hopeful. Soft dust particles float in the window light. Subtle movement of curtain fabric. 4 seconds duration, smooth cinematic motion.",

        "technical_specs": {{
          "aspect_ratio": "16:9",
          "shot_type": "Medium Close-up",
          "camera_angle": "Eye-level",
          "lens": "50mm",
          "duration": "4s"
        }},

        "negative_prompt": "cartoon, 3d render, anime, text, watermark, bad anatomy, distorted face, mutation, deformed, blurry, low resolution, overexposed, underexposed, very dark image, heavy shadows, obscured face, extra limbs, duplicate"
      }},
      {{
        "scene_id": 2,
        "scene_type": "PIVOTAL",
        "characters_in_scene": ["nvc", "nvp1"],
        "reference_files": ["nvc.png"],
        "child_text_injection": "a 7-year-old Caucasian girl with blonde pigtails tied with pink ribbons, wearing a light blue summer dress with white polka dots",

        "img_prompt": "Eye-level medium shot, 35mm lens. Two people in frame. In the foreground on the left: a 32-year-old Caucasian woman with long wavy chestnut brown hair wearing a cream-colored knit cardigan. In the background on the right: a 7-year-old Caucasian girl with blonde pigtails tied with pink ribbons, wearing a light blue summer dress with white polka dots, shown from behind with back of head visible. Face of adult illuminated by soft volumetric light, clear facial features. The woman kneels down reaching toward the child. Interior modern suburban house living room, daytime, warm natural light, contemporary American setting. Cinematic 4K photorealistic, shot on Arri Alexa Mini LF, shallow depth of field, soft film grain.",

        "video_prompt": "Static camera with subtle handheld drift. The woman slowly opens her arms. The child (seen from behind) takes small steps forward. Gentle swaying of the child's dress. Soft focus shift from child to woman's emotional face. 5 seconds duration, intimate emotional moment.",

        "technical_specs": {{
          "aspect_ratio": "16:9",
          "shot_type": "Medium Shot",
          "camera_angle": "Eye-level",
          "lens": "35mm",
          "duration": "5s"
        }},

        "negative_prompt": "cartoon, 3d render, anime, text, watermark, bad anatomy, distorted face, mutation, deformed, blurry, child's face visible, front view of child face, very dark image, heavy shadows"
      }}
    ]
  }}

  ## CHECKLIST TRƯỚC KHI OUTPUT:
  ✓ Mỗi img_prompt có đầy đủ: Camera + Character (với outfit) + Lighting Protocol + Action + Context + Style?
  ✓ Không còn placeholder [...] hay [INSERT...]?
  ✓ Trẻ em trong tình huống tiêu cực đã dùng Safe Shot?
  ✓ Scene có 2+ người đã mô tả vị trí tương đối?
  ✓ video_prompt mô tả chuyển động CỤ THỂ (không chung chung)?

  Chỉ trả về JSON thuần, không có markdown code block.

# =============================================================================
# PHẦN 4: NARRATOR SCENES (5 BIẾN THỂ CHO NHÂN VẬT CHÍNH)
# =============================================================================
# Variables: {main_character_info}
# =============================================================================

generate_narrator_scenes: |
  Bạn là AI Production Director. Tạo 5 static image variations cho Main Narrator để dùng xen kẽ trong video.

  ## THÔNG TIN NHÂN VẬT CHÍNH:
  {main_character_info}

  ## YÊU CẦU:
  - Subject: Nhân vật chính (narrator)
  - Framing: Upper-body portrait (vai, cánh tay, khuỷu tay visible)
  - Expression: Calm, reflective, natural storytelling expression
  - **5 OUTFITS KHÁC NHAU** (mỗi variation 1 outfit unique)
  - **5 INDOOR SETTINGS KHÁC NHAU** (KHÔNG outdoor/thiên nhiên)

  ## INDOOR SETTINGS GỢI Ý:
  - Living room với sofa
  - Kitchen với đảo bếp
  - Bedroom cạnh cửa sổ
  - Home office/Study với kệ sách
  - Dining room

  ## OUTPUT FORMAT - JSON:

  {{
    "narrator_scenes": [
      {{
        "variation": 1,
        "setting": "Living room",
        "outfit": "Soft gray cashmere sweater, delicate silver earrings",
        "prompt": "Cinematic medium shot, 85mm f/2 lens. A 32-year-old Caucasian woman with long wavy chestnut brown hair, oval face, soft green eyes. Face illuminated by soft volumetric light, clear facial features, catch light in eyes. She is wearing a soft gray cashmere sweater and delicate silver earrings. Sitting comfortably on a beige linen sofa in a modern living room. Expression is calm, warm, and reflective, as if sharing a personal story. Soft natural window light from the left. Bokeh background with blurred indoor plants and family photos. Cinematic 4K photorealistic, shot on Arri Alexa, shallow depth of field, warm color grading.",
        "negative_prompt": "cartoon, anime, outdoor, nature background, dark shadows, obscured face"
      }},
      {{
        "variation": 2,
        "setting": "Kitchen",
        "outfit": "White linen blouse with rolled sleeves, small gold hoop earrings",
        "prompt": "..."
      }},
      {{
        "variation": 3,
        "setting": "Bedroom by window",
        "outfit": "Dusty rose silk blouse, pearl stud earrings",
        "prompt": "..."
      }},
      {{
        "variation": 4,
        "setting": "Home office with bookshelves",
        "outfit": "Navy blue fitted blazer over cream top, thin gold necklace",
        "prompt": "..."
      }},
      {{
        "variation": 5,
        "setting": "Dining room",
        "outfit": "Olive green wrap top, wooden beaded bracelet",
        "prompt": "..."
      }}
    ]
  }}

  Chỉ trả về JSON thuần.

# =============================================================================
# PHẦN 5: THUMBNAIL GENERATION
# =============================================================================
# Variables: {main_character_info}, {thumbnail_text}
# =============================================================================

generate_thumbnail: |
  Bạn là AI Production Director. Tạo High-Impact Thumbnail cho video.

  ## NHÂN VẬT CHÍNH:
  {main_character_info}

  ## THUMBNAIL TEXT/CONTEXT:
  {thumbnail_text}

  ## QUY TẮC BẮT BUỘC:
  1. **SOLO SHOT ONLY** - Chỉ nhân vật chính, KHÔNG có người khác
  2. **BRIGHT LIGHTING** - Mặt và background phải sáng rõ, dễ nhìn trên thumbnail nhỏ
  3. **STRONG EMOTION** - Expression phải rõ ràng, đọc được ở kích thước nhỏ
  4. **HIGH CONTRAST** - Subject phải nổi bật khỏi background
  5. **COMPOSITION** - Centered hoặc rule-of-thirds, để space cho text overlay

  ## OUTPUT FORMAT - JSON:

  {{
    "thumbnail": {{
      "visual_concept": "Giải thích ngắn tại sao chọn expression/pose này",
      "emotion": "Primary emotion to convey",

      "prompt": "High-impact YouTube thumbnail shot, 85mm portrait lens. A 32-year-old Caucasian woman with long wavy chestnut brown hair, oval face, soft green eyes, wearing [outfit]. SOLO SHOT, no other people in frame. Her expression is [specific emotion] - [describe facial details: eyebrows, eyes, mouth]. Face and background brightly lit with soft white key light and fill light, no harsh shadows, high visibility. Clean blurred background in [color] tones with subtle bokeh. Subject positioned slightly off-center leaving space on [left/right] for text. Cinematic 4K, sharp focus on face, shallow depth of field, vibrant colors, high contrast.",

      "technical_specs": {{
        "aspect_ratio": "16:9",
        "shot_type": "Close-up or Medium Close-up",
        "composition": "Off-center with text space",
        "lighting": "High-key, bright, no shadows on face"
      }},

      "negative_prompt": "multiple people, dark shadows, obscured face, underexposed, low contrast, blurry, text, watermark, busy background, cluttered"
    }}
  }}

  Chỉ trả về JSON thuần.

# =============================================================================
# PHẦN 6: STYLE PREFIXES (GIỮ NGUYÊN NHƯNG NÂNG CẤP)
# =============================================================================

style_prefix: |
  Cinematic 4K photorealistic, shot on Arri Alexa Mini LF, shallow depth of field,
  soft film grain, natural color grading, high dynamic range, balanced exposure,
  face illuminated by soft volumetric light, clear facial features,

video_style_prefix: |
  Smooth cinematic motion, professional footage, natural movement,
  subtle camera drift, atmospheric,

# =============================================================================
# PHẦN 7: NEGATIVE PROMPTS LIBRARY
# =============================================================================

negative_prompts:
  standard: |
    cartoon, 3d render, anime, illustration, painting, drawing,
    text, watermark, logo, signature, bad anatomy, distorted face,
    mutation, deformed, ugly, blurry, low resolution, overexposed,
    underexposed, very dark image, heavy shadows, obscured face

  portrait: |
    cartoon, anime, 3d render, bad anatomy, distorted face, asymmetrical face,
    mutation, deformed, ugly, blurry, low resolution, overexposed,
    underexposed, dark shadows on face, obscured features, extra limbs,
    watermark, text, busy background

  scene_with_child: |
    cartoon, anime, 3d render, child's face in distress visible,
    front view of crying child, scared child face visible,
    bad anatomy, distorted, blurry, dark image, text, watermark

  thumbnail: |
    multiple people, crowd, group shot, dark shadows, obscured face,
    underexposed, low contrast, blurry, text in image, watermark,
    busy cluttered background, boring composition, flat lighting

# =============================================================================
# PHẦN 8: CAMERA & LENS REFERENCE
# =============================================================================

camera_reference:
  lenses:
    "24mm": "Wide angle - Establishing shots, environments, dramatic distortion"
    "35mm": "Standard wide - Full body, 2+ characters, context + subject balance"
    "50mm": "Standard - Medium shots, natural perspective, versatile"
    "85mm": "Portrait - Close-ups, beautiful bokeh, facial details, interviews"
    "100mm+": "Telephoto - Extreme close-ups, compressed background, isolation"

  angles:
    "Eye-level": "Neutral, relatable, conversational - DEFAULT choice"
    "Low angle": "Power, dominance, heroic, imposing"
    "High angle": "Vulnerability, weakness, submission, overview"
    "Dutch tilt": "Unease, tension, psychological disturbance"
    "Bird's eye": "Omniscient view, patterns, scale"
    "Worm's eye": "Extreme power, monumentality"

  movements:
    "Static": "Stable, observational, documentary feel"
    "Push-in": "Increasing tension, focus, revelation"
    "Pull-out": "Reveal context, isolation, ending"
    "Pan": "Follow action, reveal space horizontally"
    "Tilt": "Reveal height, power dynamics"
    "Tracking": "Follow subject, immersive, dynamic"
    "Handheld drift": "Subtle life, documentary authenticity"

# =============================================================================
# PHẦN 9: TEST PROMPT CHO TOKEN EXTRACTION
# =============================================================================

test_prompt: "beautiful sunset over ocean, golden hour, dramatic clouds, cinematic 4K"

# =============================================================================
# END OF CONFIGURATION
# =============================================================================
