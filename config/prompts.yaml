# =============================================================================
# UNI-X VOICE TO VIDEO - PROMPTS CONFIGURATION v5.0 (AI PRODUCTION DIRECTOR)
# =============================================================================
# Theo chuan AI Production Director voi 3-Step Workflow:
# - Step 1: PACING & SLICING (segment text 8-20 words)
# - Step 2: DIRECTOR'S VISUAL BLUEPRINT (scene direction)
# - Step 3: PRODUCTION EXECUTION (assets + scene JSON)
#
# OUTPUT: JSON thuan, de parse va su dung
# =============================================================================

# =============================================================================
# GLOBAL STYLE DEFINITION (MASTER STRING - PASTE NGUYEN VAN)
# =============================================================================

global_style_string: "Cinematic, 4K photorealistic, shot on Arri Alexa, soft film grain, High Key Lighting, Balanced Exposure, well-lit, soft fill light, no crushing shadows, highly detailed texture, professional color grading"

visual_clarity_string: "Face illuminated by soft volumetric light, clear facial features, high visibility"

negative_prompt_string: "cartoon, 3d render, text, watermark, bad anatomy, distorted face, very dark image, underexposed, wrong face, different character, inconsistent appearance"

# =============================================================================
# STEP 1 + 2: ANALYZE STORY (Character Bible + Location Bible + Pacing)
# =============================================================================
# Input: {story_text}
# Output: JSON voi characters, locations, va pacing script
# =============================================================================

analyze_story: |
  Ban la AI Production Director. Phan tich kich ban va tao Production Kit.

  ## INPUT SCRIPT:
  ---
  {story_text}
  ---

  ## NHIEM VU:

  ### A. CHARACTER BIBLE (QUAN TRONG NHAT - Trich xuat TAT CA nhan vat)
  - PHAI tim va liet ke TAT CA nhan vat xuat hien trong truyen (chinh + phu)
  - Moi nhan vat can co:
    * portrait_prompt: Anh chan dung (white background, neutral face, studio lighting)
    * character_lock: Mo ta CHI TIET de paste vao scene (PHAI co: tuoi, gioi tinh, toc, mat, da, TRANG PHUC)

  ### B. LOCATION BIBLE (Trich xuat TAT CA boi canh)
  - PHAI tim va liet ke TAT CA dia diem/boi canh trong truyen
  - Moi location can:
    * location_prompt: Anh boi canh (empty, no people)
    * location_lock: Mo ta CHI TIET de paste vao scene

  ### C. KEY OBJECTS (Vat the quan trong neu co)
  - Chi liet ke neu co vat the dac biet trong truyen

  ## OUTPUT FORMAT - PURE JSON (khong markdown):

  {{
    "production_info": {{
      "title": "Ten cau chuyen",
      "genre": "Drama/Comedy/etc",
      "total_characters": 3,
      "total_locations": 2
    }},

    "global_style": "Cinematic, 4K photorealistic, shot on Arri Alexa, soft film grain, High Key Lighting, Balanced Exposure, well-lit, soft fill light, no crushing shadows, highly detailed texture, professional color grading",

    "characters": [
      {{
        "id": "nv1",
        "name": "Minh",
        "role": "main",
        "age": 32,
        "gender": "male",
        "is_child": false,
        "filename": "nv1.png",
        "portrait_prompt": "A cinematic portrait, straight-on medium close-up shot on 85mm portrait lens. Subject is a 32-year-old Vietnamese man with short black side-parted hair, oval face, double eyelids, light tan skin. Looking directly at camera with completely neutral expression. Bright, even studio lighting, fully illuminated face. Pure white studio background. Wearing plain navy polo shirt. 8K, sharp focus, high fidelity portraiture, photorealistic.",
        "character_lock": "Minh, 32-year-old Vietnamese man with short black side-parted hair, oval face, light tan skin, wearing navy blue polo shirt and dark gray slacks"
      }},
      {{
        "id": "nv2",
        "name": "Lan",
        "role": "supporting",
        "age": 30,
        "gender": "female",
        "is_child": false,
        "filename": "nv2.png",
        "portrait_prompt": "A cinematic portrait, straight-on medium close-up shot on 85mm portrait lens. Subject is a 30-year-old Vietnamese woman with long straight black center-parted hair, round face, fair skin, rosy cheeks. Looking directly at camera with completely neutral expression. Bright, even studio lighting, fully illuminated face. Pure white studio background. Wearing cream-colored blouse. 8K, sharp focus, high fidelity portraiture, photorealistic.",
        "character_lock": "Lan, 30-year-old Vietnamese woman with long straight black center-parted hair, round face, fair skin, wearing cream-colored blouse and light pink cardigan"
      }},
      {{
        "id": "nvc1",
        "name": "Bao",
        "role": "supporting",
        "age": 8,
        "gender": "male",
        "is_child": true,
        "filename": "NONE",
        "portrait_prompt": "DO_NOT_GENERATE",
        "character_lock": "Bao, 8-year-old Vietnamese boy with short black hair, round chubby face, wearing blue school uniform"
      }}
    ],

    "locations": [
      {{
        "id": "loc1",
        "name": "Phong khach",
        "filename": "loc1.png",
        "location_prompt": "Interior wide shot of modern Vietnamese apartment living room. Empty room, no people. Beige leather sofa, wooden coffee table, large window with city view, warm afternoon sunlight streaming in, minimalist decor, potted plants, cream-colored walls. Cinematic, 4K photorealistic, well-lit, soft natural lighting. 8K, architectural photography style.",
        "location_lock": "Modern apartment living room, beige leather sofa, wooden coffee table, large window with city view, cream-colored walls, warm afternoon sunlight",
        "lighting_default": "Warm natural window light from the right"
      }},
      {{
        "id": "loc2",
        "name": "Van phong",
        "filename": "loc2.png",
        "location_prompt": "Interior wide shot of corporate office space. Empty room, no people. Glass partitions, fluorescent ceiling lights, computer monitors on desks, ergonomic office chairs, neutral gray carpet, modern minimalist design. Cinematic, 4K photorealistic, well-lit. 8K, architectural photography style.",
        "location_lock": "Corporate office space, glass partitions, fluorescent ceiling lights, computer monitors on desks, gray carpet, modern minimalist design",
        "lighting_default": "Cool blue-white fluorescent overhead lighting"
      }}
    ],

    "key_objects": [
      {{
        "id": "obj1",
        "name": "Wedding Ring",
        "filename": "obj1.png",
        "object_prompt": "Extreme macro close-up of a simple gold wedding band with slight wear marks, sitting on white marble surface. Soft diffused studio lighting from above. Shallow depth of field. 8K, product photography style, photorealistic."
      }}
    ]
  }}

  ## QUY TAC BAT BUOC:
  1. PHAI trich xuat TAT CA nhan vat duoc nhac den trong truyen (ke ca chi xuat hien 1 lan)
  2. PHAI trich xuat TAT CA boi canh/dia diem duoc nhac den trong truyen
  3. character_lock PHAI co: Ten + Tuoi + Gioi tinh + Dac diem khuon mat + Toc + Da + TRANG PHUC
  4. location_lock PHAI co: Loai dia diem + Cac vat the chinh + Anh sang
  5. portrait_prompt: PHAI co "Pure white studio background", "neutral expression", "looking directly at camera"
  6. location_prompt: PHAI co "Empty room, no people"
  7. Tre em (is_child=true): portrait_prompt = "DO_NOT_GENERATE", filename = "NONE"
  8. ID format: nv1, nv2, nv3... (nhan vat), nvc1, nvc2... (tre em), loc1, loc2... (boi canh)
  9. filename DUNG .png (KHONG DUNG .jpg)
  10. Chi tra ve JSON thuan, KHONG co markdown code block

# =============================================================================
# STEP 3: SCENE PRODUCTION (Tao prompt cho tung scene)
# =============================================================================
# Input: {characters_info}, {locations_info}, {pacing_script}, {global_style}
# Output: JSON array cua scenes
# =============================================================================

generate_scenes: |
  Ban la AI Production Director. Tao visual prompt cho tung scene, SU DUNG ANH THAM CHIEU (reference images).

  ## NGUYEN TAC BAT BUOC:

  ### 1. SCENE LA HANH DONG, KHONG PHAI PORTRAIT:
  - Nhan vat DANG LAM GI DO - khong phai dung pose
  - KHONG BAO GIO nhin thang vao camera
  - KHONG dung "looking at camera", "facing viewer", "portrait"
  - Mo ta HANH DONG: dang di, dang noi, dang nghi, dang lam viec...

  ### 2. SU DUNG THAM CHIEU DUNG CACH:
  - **character_lock**: Chi dung MO TA NGOAI HINH (tuoi, toc, mat, quan ao)
  - KHONG copy phan "looking at camera" tu portrait prompt
  - Them HANH DONG vao sau mo ta ngoai hinh
  - Vi du: "Minh, 32 tuoi, toc den ngan... DANG NGOI DOC SACH"

  ### 3. MOI SCENE = 1 KHOANH KHAC:
  - Moi scene trong input = 1 scene output
  - Mo ta KHOANH KHAC cu the trong cau chuyen

  ### 4. LOCATION + LIGHTING:
  - **location_lock**: COPY NGUYEN VAN lam background
  - Them anh sang phu hop voi thoi diem trong ngay

  ### 5. GLOBAL STYLE INJECTION:
  - Ket thuc moi img_prompt bang global_style string

  ## INPUT DATA:
  **GLOBAL_STYLE:** {global_style}

  **CHARACTERS (Chi dung phan mo ta ngoai hinh, BO QUA "looking at camera"):**
  {characters_info}

  **LOCATIONS (Dung location_lock nguyen van):**
  {locations_info}

  **SCENES (Noi dung can tao prompt - TAP TRUNG VAO HANH DONG):**
  (Moi scene da co Location - PHAI dung location_id do cho location_used!)
  {scenes_info}

  ## OUTPUT FORMAT - JSON ARRAY:

  Tra ve JSON object voi key "scenes" chua array:

  {{
    "scenes": [
      {{
        "scene_id": 1,
        "characters_used": ["nv1"],
        "location_used": "loc1",
        "reference_files": ["nv1.png", "loc1.png"],
        "img_prompt": "Wide shot, 24mm lens. Minh, 32-year-old Vietnamese man with short black side-parted hair, oval face, light tan skin, wearing navy blue polo shirt, WALKING SLOWLY toward the window, his back partially turned to viewer. Modern apartment living room, beige sofa, wooden coffee table, large window with city view, warm afternoon sunlight streaming in. Cinematic, 4K photorealistic, shot on Arri Alexa, soft film grain, natural lighting.",
        "video_prompt": "Slow tracking shot following Minh as he walks to window."
      }},
      {{
        "scene_id": 2,
        "characters_used": ["nv1", "nv2"],
        "location_used": "loc1",
        "reference_files": ["nv1.png", "nv2.png", "loc1.png"],
        "img_prompt": "Over-the-shoulder shot from behind Lan, 50mm lens. Minh, 32-year-old Vietnamese man with short black side-parted hair, sitting on beige sofa, LEANING FORWARD while speaking, hands gesturing. In soft focus foreground: back of Lan's head, long black hair. Two people in conversation. Modern apartment living room, warm afternoon light. Cinematic, 4K photorealistic, natural lighting.",
        "video_prompt": "Minh speaks animatedly, hands moving to emphasize points."
      }},
      {{
        "scene_id": 3,
        "characters_used": ["nv1"],
        "location_used": "loc1",
        "reference_files": ["nv1.png", "loc1.png"],
        "img_prompt": "Extreme close-up, 100mm macro lens. Minh's hands CLENCHING into fists on his lap, knuckles whitening, wedding ring visible. Shallow depth of field. Warm afternoon lighting. Cinematic, 4K photorealistic.",
        "video_prompt": "The hands slowly tighten, tension building."
      }}
    ]
  }}

  ## HANH DONG GUIDE (Thay vi pose):
  - Sad/Thinking: nhin ra cua so, cui dau, tay om mat
  - Happy: cuoi voi nguoi khac, om, bat tay
  - Angry: nam dam, dung day, quay lung
  - Talking: nghieng nguoi, dua tay, nhin nguoi doi dien
  - Walking: dang buoc di, lung quay lai
  - Working: dang viet, dang doc, dang lam viec

  ## KHONG DUOC LAM:
  - KHONG: "looking at camera", "facing viewer", "portrait shot"
  - KHONG: "neutral expression", "standing straight"
  - KHONG: nhan vat dung yen khong lam gi

  OUTPUT: JSON object voi key "scenes", KHONG co markdown code block.

# =============================================================================
# STEP 2.5: SMART SCENE DIVISION (Chia scene theo noi dung)
# =============================================================================
# Input: {srt_with_timestamps} - SRT entries voi timestamps
# Output: JSON array cua scenes duoc chia theo noi dung
# =============================================================================

smart_divide_scenes: |
  Ban la AI Director chuyen nghiep. Chia cau chuyen thanh cac SHOT de tao anh minh hoa NHU PHIM THAT.

  ## FLOW DAO DIEN (QUAN TRONG!):

  ```
  NOI DUNG (SRT)
       ↓
  XAC DINH BOI CANH (Settings/Locations)
       ↓
  NHOM THEO BOI CANH (moi boi canh = 1 khoi)
       ↓
  CHIA SHOT TRONG MOI BOI CANH (max 8s/shot)
       ↓
  TẠO VISUAL MOMENT cho moi shot
  ```

  ## INPUT - SRT voi timestamps:
  ---
  {srt_with_timestamps}
  ---

  ## BUOC 1: XAC DINH CAC BOI CANH (LOCATIONS)

  Doc noi dung va xac dinh cac boi canh xuat hien:
  - Boi canh = noi dien ra hanh dong (nha, cong vien, van phong, duong pho...)
  - Moi lan thay doi boi canh = bat dau khoi moi
  - Danh so: loc1, loc2, loc3...

  Vi du:
  ```
  [00:00 - 00:30] Nha rieng → loc1
  [00:30 - 01:15] Cong vien → loc2
  [01:15 - 02:00] Quan cafe → loc3
  [02:00 - 02:30] Nha rieng → loc1 (quay lai)
  ```

  ## BUOC 2: CHIA SHOT TRONG MOI BOI CANH

  Moi boi canh chia thanh cac shot (max 8s/shot):
  - Noi dung ngan (1-8s): 1 shot
  - Noi dung vua (8-16s): 2 shots
  - Noi dung dai (16-24s): 3 shots
  - Noi dung rat dai (>24s): 4+ shots

  ## BUOC 3: CHON GOC MAY PHU HOP

  - Bat dau boi canh moi → Wide shot (thiet lap)
  - Hanh dong chinh → Medium shot
  - Cam xuc/phan ung → Close-up
  - Doi thoai → Two-shot hoac OTS
  - Chi tiet → Extreme close-up

  ## OUTPUT FORMAT - JSON:

  {{
    "total_shots": 15,
    "total_duration": "02:30",
    "story_analysis": "Tom tat ngan gon cau chuyen",
    "locations": [
      {{"id": "loc1", "name": "Nha rieng", "description": "Can phong am cung"}},
      {{"id": "loc2", "name": "Cong vien", "description": "Cong vien xanh mat"}}
    ],
    "scenes": [
      {{
        "scene_id": 1,
        "location_id": "loc1",
        "story_beat": "Nhan vat thuc day",
        "start_time": "00:00:00",
        "end_time": "00:00:06",
        "duration_seconds": 6,
        "srt_indices": [1, 2],
        "shot_type": "Wide shot",
        "text": "Noi dung tu SRT",
        "visual_moment": "Wide shot can phong ngu sang som, nguoi dan ong dang ngoi day tren giuong"
      }},
      {{
        "scene_id": 2,
        "location_id": "loc1",
        "story_beat": "Nhan vat thuc day",
        "start_time": "00:00:06",
        "end_time": "00:00:12",
        "duration_seconds": 6,
        "srt_indices": [2, 3],
        "shot_type": "Close-up",
        "text": "Noi dung tu SRT",
        "visual_moment": "Close-up khuon mat nguoi dan ong, mat chua tinh ngu"
      }},
      {{
        "scene_id": 3,
        "location_id": "loc2",
        "story_beat": "Chuyen sang cong vien",
        "start_time": "00:00:30",
        "end_time": "00:00:38",
        "duration_seconds": 8,
        "srt_indices": [5, 6],
        "shot_type": "Wide shot",
        "text": "Noi dung tu SRT",
        "visual_moment": "Wide shot establishing - Cong vien xanh mat voi nguoi dan ong dang di bo"
      }}
    ]
  }}

  ## NGUYEN TAC VANG:

  1. **BOI CANH TRUOC**: Xac dinh boi canh truoc khi chia shot
  2. **LIEN TUC**: Cac shot trong cung boi canh phai lien tuc ve thoi gian
  3. **MAX 8s**: Khong shot nao vuot qua 8 giay
  4. **WIDE SHOT DAU TIEN**: Moi boi canh moi bat dau bang Wide shot
  5. **LOCATION_ID BAT BUOC**: Moi shot PHAI co location_id
  6. **COVER TOAN BO**: Phai cover tu dau den cuoi SRT, KHONG BO SOT

  ## CHECKLIST:
  - [ ] Da xac dinh tat ca boi canh?
  - [ ] Moi shot co location_id?
  - [ ] Khong shot nao > 8s?
  - [ ] Da cover tu 00:00:00 den het SRT?
  - [ ] Shot dau moi boi canh la Wide shot?

  OUTPUT: JSON object, KHONG co markdown code block.

# =============================================================================
# CAMERA REFERENCE
# =============================================================================

camera_reference:
  shot_types:
    "Extreme Wide Shot (EWS)": "Environment dominant, tiny subject"
    "Wide Shot (WS)": "Full body + environment"
    "Medium Shot (MS)": "Waist up"
    "Medium Close-up (MCU)": "Chest up"
    "Close-up (CU)": "Face fills frame"
    "Extreme Close-up (ECU)": "Part of face/detail"
    "Over-the-shoulder (OTS)": "Behind one person looking at another"
    "Two-shot": "Two people in frame"

  angles:
    "Eye-level": "Neutral, viewer = observer"
    "Low angle": "Subject has power, heroic"
    "High angle": "Subject vulnerable, small"
    "Dutch tilt": "Unease, tension"
    "Over-the-shoulder": "Connection, conversation"

  lenses:
    "24mm": "Wide - Establishing, environments"
    "35mm": "Wide normal - Full body, groups"
    "50mm": "Normal - Dialogue, versatile"
    "85mm": "Portrait - Face detail, interviews"
    "100mm": "Macro - Details, hands, objects"

# =============================================================================
# END v5.0
# =============================================================================
