# =============================================================================
# UNI-X VOICE TO VIDEO - PROMPTS CONFIGURATION v5.0 (AI PRODUCTION DIRECTOR)
# =============================================================================
# Theo chuan AI Production Director voi 3-Step Workflow:
# - Step 1: PACING & SLICING (segment text 8-20 words)
# - Step 2: DIRECTOR'S VISUAL BLUEPRINT (scene direction)
# - Step 3: PRODUCTION EXECUTION (assets + scene JSON)
#
# OUTPUT: JSON thuan, de parse va su dung
# =============================================================================

# =============================================================================
# GLOBAL STYLE DEFINITION (MASTER STRING - PASTE NGUYEN VAN)
# =============================================================================

global_style_string: "Cinematic, 4K photorealistic, shot on Arri Alexa, soft film grain, High Key Lighting, Balanced Exposure, well-lit, soft fill light, no crushing shadows, highly detailed texture, professional color grading"

visual_clarity_string: "Face illuminated by soft volumetric light, clear facial features, high visibility"

negative_prompt_string: "cartoon, 3d render, text, watermark, bad anatomy, distorted face, very dark image, underexposed, wrong face, different character, inconsistent appearance"

# =============================================================================
# STEP 1 + 2: ANALYZE STORY (Director's Vision + Character + Location Bible)
# =============================================================================
# Input: {story_text}
# Output: JSON voi world_setting, characters, locations
# =============================================================================

analyze_story: |
  Ban la AI Production Director (Dao dien). Phan tich kich ban va tao Production Kit.

  ## INPUT SCRIPT:
  ---
  {story_text}
  ---

  ## NHIEM VU - LAM THEO THU TU:

  ### BUOC 1: DIRECTOR'S VISION (PHAN TICH THE GIOI CAU CHUYEN TRUOC!)
  Doc ky cau chuyen va xac dinh:
  - **Era (Thoi dai)**: Hien dai? 1990s? 1970s? Thoi phong kien?
  - **Setting (Moi truong)**: Thanh thi? Nong thon? Mien nui? Ven bien?
  - **Social class (Tang lop)**: Giau co? Trung luu? Ngheo kho? Nong dan?
  - **Tone (Tone mau)**: Am ap? Lanh leo? U am? Tuoi sang?
  - **Region (Vung mien)**: Mien Bac? Mien Trung? Mien Nam? Tay Nguyen?

  TU WORLD SETTING NAY → Quyet dinh PHONG CACH cho nhan vat va boi canh!

  ### BUOC 2: CHARACTER BIBLE ("Cast" nhan vat PHU HOP voi the gioi)
  - Moi nhan vat PHAI phu hop voi world setting da xac dinh
  - Neu truyen nong thon ngheo → nhan vat mac ao ba ba, da ngam, toc gian di
  - Neu truyen thanh thi hien dai → nhan vat mac ao so mi, da sang, toc thoi trang
  - Neu truyen thoi xua → nhan vat mac ao dai/ao tu than, toc bui/tet

  ### BUOC 3: LOCATION BIBLE ("Scout" boi canh PHU HOP voi the gioi)
  - Moi boi canh PHAI phu hop voi world setting da xac dinh
  - Neu truyen nong thon → nha la, duong dat, dong lua, ao ca
  - Neu truyen thanh thi → chung cu, van phong, quan cafe, duong nhua
  - Neu truyen thoi xua → nha go, san dinh, chua chien

  ### BUOC 4: KEY OBJECTS (Chi liet ke neu co vat the dac biet)

  ## OUTPUT FORMAT - PURE JSON (khong markdown):
  ## IMPORTANT: ALL names MUST be in ENGLISH (not Vietnamese)!

  {{
    "production_info": {{
      "title": "Story Title",
      "genre": "Drama/Comedy/etc",
      "total_characters": 3,
      "total_locations": 2
    }},

    "world_setting": {{
      "era": "Present day 2020s",
      "setting": "Small town Ohio, USA",
      "social_class": "Working class",
      "tone": "Dramatic, emotional",
      "region": "American Midwest",
      "visual_style": "Natural lighting, realistic tones, suburban American aesthetic"
    }},

    "global_style": "Cinematic, 4K photorealistic, shot on Arri Alexa, soft film grain, natural American suburban lighting",

    "context_lock": "Present day small town Ohio, working class neighborhood, modest suburban homes, courthouse, convenience stores",

    "characters": [
      {{
        "id": "nvc",
        "name": "Narrator (Me)",
        "role": "main",
        "age": 30,
        "gender": "male",
        "is_child": false,
        "filename": "nvc.png",
        "portrait_prompt": "A cinematic portrait, straight-on medium close-up shot on 85mm lens. Subject is a 30-year-old Caucasian man with short brown hair, tired blue eyes, light stubble, fair skin showing signs of stress. Looking directly at camera with neutral expression. Bright studio lighting, fully illuminated face. Pure white studio background. Wearing simple gray t-shirt. 8K, sharp focus, photorealistic.",
        "character_lock": "30-year-old Caucasian man, short brown hair, tired blue eyes, light stubble, wearing simple gray t-shirt"
      }},
      {{
        "id": "nv1",
        "name": "Mother (Gloria)",
        "role": "supporting",
        "age": 55,
        "gender": "female",
        "is_child": false,
        "filename": "nv1.png",
        "portrait_prompt": "A cinematic portrait, straight-on medium close-up shot on 85mm lens. Subject is a 55-year-old Caucasian woman with graying blonde hair in a ponytail, tired hazel eyes, worn face showing years of hard work. Looking directly at camera with neutral expression. Bright studio lighting. Pure white studio background. Wearing faded blue work uniform. 8K, sharp focus, photorealistic.",
        "character_lock": "55-year-old Caucasian woman, graying blonde hair in ponytail, tired hazel eyes, worn face, wearing faded blue work uniform"
      }},
      {{
        "id": "nvc1",
        "name": "Young Me (Child)",
        "role": "supporting",
        "age": 8,
        "gender": "male",
        "is_child": true,
        "filename": "NONE",
        "portrait_prompt": "DO_NOT_GENERATE",
        "character_lock": "8-year-old Caucasian boy, messy brown hair, innocent blue eyes, wearing old t-shirt and jeans"
      }}
    ],

    "locations": [
      {{
        "id": "loc1",
        "name": "Courthouse Steps",
        "filename": "loc1.png",
        "location_prompt": "Exterior wide shot of small town American courthouse. Empty, no people. Gray stone steps, white columns, American flag, official government building facade. Overcast day lighting. Cinematic, 4K photorealistic. 8K, architectural style.",
        "location_lock": "Small town American courthouse exterior, gray stone steps, white columns, American flag, overcast day",
        "lighting_default": "Overcast natural daylight, soft shadows"
      }},
      {{
        "id": "loc2",
        "name": "Small Apartment",
        "filename": "loc2.png",
        "location_prompt": "Interior wide shot of small working class American apartment from 1990s. Empty, no people. Thin walls, old carpet, small TV on stand, worn sofa, single window with thin curtains, radiator heater. Warm tungsten indoor lighting. Cinematic, 4K photorealistic. 8K.",
        "location_lock": "1990s small American apartment interior, thin walls, old carpet, worn sofa, small TV, warm tungsten indoor lighting",
        "lighting_default": "Warm tungsten indoor lighting"
      }}
    ],

    "key_objects": []
  }}

  ## EXAMPLE 2 - Modern Urban Story:
  If story is about city office life:
  - world_setting.setting = "Modern New York City"
  - characters: wearing suits, business casual
  - locations: glass office buildings, upscale apartments, coffee shops

  ## EXAMPLE 3 - Historical Story:
  If story is set in the past:
  - world_setting.era = "1950s America"
  - characters: period-appropriate clothing
  - locations: period-accurate buildings, cars, decor

  ## MANDATORY RULES:
  1. ALL "name" fields MUST be in ENGLISH (e.g., "Mother", "Courthouse", NOT "Me", "Toa an")
  2. ALL prompts (portrait_prompt, location_prompt, character_lock, location_lock) MUST be in ENGLISH
  3. Analyze world_setting FIRST before creating characters/locations
  4. Characters + Locations MUST match world_setting (same era, same style, same tone)
  5. Extract ALL characters mentioned in story (even if only appears once)
  6. Extract ALL locations/places mentioned in story
  7. character_lock MUST have: Name + Age + Gender + Face features + Hair + Skin + CLOTHING (matching world_setting!)
  8. location_lock MUST have: Place type + Key objects + Lighting (matching world_setting!)
  9. portrait_prompt: MUST have "Pure white studio background", "neutral expression", "looking directly at camera"
  10. location_prompt: MUST have "Empty room, no people"
  11. Children (is_child=true): portrait_prompt = "DO_NOT_GENERATE", filename = "NONE"
  12. ID format: nvc (main/narrator), nv1, nv2... (supporting), nvc1, nvc2... (children), loc1, loc2... (locations)
  13. filename uses .png (NOT .jpg)
  14. Return pure JSON only, NO markdown code blocks

  ## CONSISTENCY CHECK:
  Before returning, verify:
  - Do character CLOTHES match world_setting?
  - Do location OBJECTS match world_setting?
  - Is the TONE consistent across all?

  BAD EXAMPLES (inconsistent):
  - world_setting = "1990s rural Ohio" + character wearing "modern designer suit" ❌
  - world_setting = "modern NYC office" + location is "wooden farmhouse" ❌

# =============================================================================
# STEP 3: SCENE PRODUCTION (Tao prompt cho tung scene)
# =============================================================================
# Input: {characters_info}, {locations_info}, {pacing_script}, {global_style}
# Output: JSON array cua scenes
# =============================================================================

generate_scenes: |
  Ban la AI Production Director. Tao visual prompt cho tung scene, SU DUNG ANH THAM CHIEU (reference images).

  ## NGUYEN TAC BAT BUOC:

  ### 1. SCENE LA HANH DONG, KHONG PHAI PORTRAIT:
  - Nhan vat DANG LAM GI DO - khong phai dung pose
  - KHONG BAO GIO nhin thang vao camera
  - KHONG dung "looking at camera", "facing viewer", "portrait"
  - Mo ta HANH DONG: dang di, dang noi, dang nghi, dang lam viec...

  ### 2. SU DUNG THAM CHIEU DUNG CACH:
  - **character_lock**: Chi dung MO TA NGOAI HINH (tuoi, toc, mat, quan ao)
  - KHONG copy phan "looking at camera" tu portrait prompt
  - Them HANH DONG vao sau mo ta ngoai hinh
  - Vi du: "Minh, 32 tuoi, toc den ngan... DANG NGOI DOC SACH"

  ### 3. MOI SCENE = 1 KHOANH KHAC:
  - Moi scene trong input = 1 scene output
  - Mo ta KHOANH KHAC cu the trong cau chuyen

  ### 4. LOCATION + LIGHTING:
  - **location_lock**: COPY NGUYEN VAN lam background
  - Them anh sang phu hop voi thoi diem trong ngay

  ### 5. GLOBAL STYLE INJECTION:
  - Ket thuc moi img_prompt bang global_style string

  ## INPUT DATA:
  **GLOBAL_STYLE:** {global_style}

  **CHARACTERS (Chi dung phan mo ta ngoai hinh, BO QUA "looking at camera"):**
  {characters_info}

  **LOCATIONS (Dung location_lock nguyen van):**
  {locations_info}

  **SCENES (Noi dung can tao prompt - TAP TRUNG VAO HANH DONG):**
  (Moi scene da co Location - PHAI dung location_id do cho location_used!)
  {scenes_info}

  ## OUTPUT FORMAT - JSON ARRAY:

  Tra ve JSON object voi key "scenes" chua array:

  {{
    "scenes": [
      {{
        "scene_id": 1,
        "characters_used": ["nv1"],
        "location_used": "loc1",
        "reference_files": ["nv1.png", "loc1.png"],
        "img_prompt": "Wide shot, 24mm lens. Minh, 32-year-old Vietnamese man with short black side-parted hair, oval face, light tan skin, wearing navy blue polo shirt, WALKING SLOWLY toward the window, his back partially turned to viewer. Modern apartment living room, beige sofa, wooden coffee table, large window with city view, warm afternoon sunlight streaming in. Cinematic, 4K photorealistic, shot on Arri Alexa, soft film grain, natural lighting.",
        "video_prompt": "Slow tracking shot following Minh as he walks to window."
      }},
      {{
        "scene_id": 2,
        "characters_used": ["nv1", "nv2"],
        "location_used": "loc1",
        "reference_files": ["nv1.png", "nv2.png", "loc1.png"],
        "img_prompt": "Over-the-shoulder shot from behind Lan, 50mm lens. Minh, 32-year-old Vietnamese man with short black side-parted hair, sitting on beige sofa, LEANING FORWARD while speaking, hands gesturing. In soft focus foreground: back of Lan's head, long black hair. Two people in conversation. Modern apartment living room, warm afternoon light. Cinematic, 4K photorealistic, natural lighting.",
        "video_prompt": "Minh speaks animatedly, hands moving to emphasize points."
      }},
      {{
        "scene_id": 3,
        "characters_used": ["nv1"],
        "location_used": "loc1",
        "reference_files": ["nv1.png", "loc1.png"],
        "img_prompt": "Extreme close-up, 100mm macro lens. Minh's hands CLENCHING into fists on his lap, knuckles whitening, wedding ring visible. Shallow depth of field. Warm afternoon lighting. Cinematic, 4K photorealistic.",
        "video_prompt": "The hands slowly tighten, tension building."
      }}
    ]
  }}

  ## HANH DONG GUIDE (Thay vi pose):
  - Sad/Thinking: nhin ra cua so, cui dau, tay om mat
  - Happy: cuoi voi nguoi khac, om, bat tay
  - Angry: nam dam, dung day, quay lung
  - Talking: nghieng nguoi, dua tay, nhin nguoi doi dien
  - Walking: dang buoc di, lung quay lai
  - Working: dang viet, dang doc, dang lam viec

  ## KHONG DUOC LAM:
  - KHONG: "looking at camera", "facing viewer", "portrait shot"
  - KHONG: "neutral expression", "standing straight"
  - KHONG: nhan vat dung yen khong lam gi

  OUTPUT: JSON object voi key "scenes", KHONG co markdown code block.

# =============================================================================
# STEP 2.5: SMART SCENE DIVISION (Chia scene theo noi dung)
# =============================================================================
# Input: {srt_with_timestamps} - SRT entries voi timestamps
# Output: JSON array cua scenes duoc chia theo noi dung
# =============================================================================

smart_divide_scenes: |
  You are an AI Director for a STORY NARRATION video (one person telling their life story).

  ## UNDERSTAND THE STORY STRUCTURE FIRST:
  This is a PERSONAL STORY told by a narrator. It has:
  1. **FRAME NARRATIVE**: The "present moment" where narrator is telling the story (e.g., sitting on courthouse steps)
  2. **FLASHBACKS**: Memories from different time periods (childhood, teen years, adulthood)
  3. **EMOTIONAL BEATS**: Reflective moments where narrator expresses feelings
  4. **META CONTENT**: YouTube CTAs (like/subscribe) - not part of the story

  ## CONTEXT - CHARACTERS AND LOCATIONS:
  {characters_info}

  {locations_info}

  ## INPUT - Scenes (max 8s/scene):
  ---
  {srt_with_timestamps}
  ---

  ## SCENE TYPE CLASSIFICATION:

  ### 1. FRAME_PRESENT (Return to this often!)
  When narrator describes their CURRENT situation:
  - "I am sitting on the courthouse steps right now"
  - "She thought she would win"
  - "She had no idea what I had been saving"
  → Show: Narrator in PRESENT location (courthouse steps), contemplative or speaking
  → Character: Current age (30 years old)

  ### 2. CHILDHOOD_FLASHBACK
  Memories from childhood (ages 4-12):
  - "When I was a kid..."
  - "My mother used to..."
  - "I remember lying in bed..."
  - "She would come home smelling like detergent"
  → Show: YOUNG mother (30-35yo) + CHILD narrator (4-12yo)
  → Location: Apartment, dry cleaning shop, convenience store (from that era)
  → Warm, nostalgic lighting

  ### 3. ADULT_FLASHBACK
  Memories from young adulthood (ages 18-28):
  - "After high school I learned a trade"
  - "I became a carpenter"
  - "I built my own house"
  → Show: ADULT narrator (25-28yo) working, building
  → Location: Construction site, land, etc.
  → Determined, hopeful tone

  ### 4. EMOTIONAL_BEAT
  Pure emotional reflection (no specific scene described):
  - "You are everything to me. And I believed her."
  - "I believed every word."
  - "I would make her proud."
  → Show: Close-up of narrator's face in FRAME location, reflective expression
  → Or: Symbolic shot (hands, documents, etc.)
  → DO NOT invent random scenes!

  ### 5. YOUTUBE_CTA
  Meta content not part of story:
  - "Hit that like button and subscribe"
  - "Let me know in the comments"
  → Show: Narrator speaking directly (medium shot, frame location)
  → Keep it simple, don't create elaborate scenes

  ## NEW LOCATIONS TO CREATE:
  Based on story content, you may need to create:
  - loc_dryclean: "1990s small town dry cleaning shop, pressing machines, racks of clothes, fluorescent lights"
  - loc_convenience: "Late night convenience store, cash register, fluorescent lights, parking lot visible"
  - loc_construction: "House under construction, wooden frame, tools, sawdust, outdoor setting"
  - loc_land: "Empty plot of land, grass, trees, suburban outskirts"
  - loc_bedroom: "Small shared bedroom in apartment, two beds close together, dim light"

  ## OUTPUT FORMAT - JSON:

  {{
    "story_timeline": {{
      "frame_location": "courthouse steps",
      "narrator_current_age": 30,
      "childhood_period": "4-12 years old, 1990s",
      "adult_period": "18-28 years old, 2010s"
    }},
    "new_locations": [
      {{
        "id": "loc_dryclean",
        "name": "Dry Cleaning Shop",
        "location_lock": "1990s small town dry cleaning shop, industrial pressing machines, racks of hanging clothes, fluorescent lighting"
      }},
      {{
        "id": "loc_construction",
        "name": "House Construction Site",
        "location_lock": "House under construction, wooden frame structure, scattered tools, sawdust, sunny outdoor setting"
      }}
    ],
    "scenes": [
      {{
        "scene_id": 1,
        "scene_type": "FRAME_PRESENT",
        "timeline_note": "Present day, narrator 30yo",
        "location_id": "loc_courthouse",
        "characters_in_scene": ["nvc"],
        "shot_type": "Medium shot",
        "visual_moment": "30-year-old man sitting on gray courthouse steps, hands trembling while holding thick folder of documents, head bowed, worried expression"
      }},
      {{
        "scene_id": 2,
        "scene_type": "CHILDHOOD_FLASHBACK",
        "timeline_note": "Flashback: narrator 8yo, mother 32yo",
        "location_id": "loc2",
        "characters_in_scene": ["nv1_young", "nvc1"],
        "shot_type": "Wide shot",
        "visual_moment": "Warm-toned memory: YOUNG blonde mother (32yo) kneeling down to hug 8-year-old boy in small apartment, protective embrace, soft warm lighting"
      }},
      {{
        "scene_id": 3,
        "scene_type": "ADULT_FLASHBACK",
        "timeline_note": "Flashback: narrator 28yo",
        "location_id": "loc_construction",
        "characters_in_scene": ["nvc"],
        "shot_type": "Medium shot",
        "visual_moment": "28-year-old man swinging hammer at wooden house frame, sweat on forehead, determined expression, sunny construction site"
      }},
      {{
        "scene_id": 4,
        "scene_type": "EMOTIONAL_BEAT",
        "timeline_note": "Present reflection",
        "location_id": "loc_courthouse",
        "characters_in_scene": ["nvc"],
        "shot_type": "Close-up",
        "visual_moment": "Extreme close-up of narrator's face on courthouse steps, eyes distant and glistening, remembering the past"
      }},
      {{
        "scene_id": 5,
        "scene_type": "YOUTUBE_CTA",
        "timeline_note": "Meta - breaking fourth wall",
        "location_id": "loc_courthouse",
        "characters_in_scene": ["nvc"],
        "shot_type": "Medium shot",
        "visual_moment": "Narrator on courthouse steps looking toward camera, speaking directly to audience"
      }}
    ]
  }}

  ## CRITICAL RULES:
  1. **ALWAYS identify the timeline** - Is this present, childhood memory, or adult memory?
  2. **Use correct character ages** - Mother in childhood memories = 30-35yo, NOT 55yo
  3. **Return to FRAME location** for emotional beats and reflections
  4. **Create specific locations** for actions mentioned (dry cleaning, convenience store, construction)
  5. **Don't invent random scenes** - If text is reflective, show reflection, not random action
  6. **YouTube CTAs** - Keep simple, narrator speaking to camera

  ## MAPPING GUIDE:
  | Content Type | Scene Type | Visual |
  |-------------|-----------|--------|
  | "I am sitting..." | FRAME_PRESENT | Narrator at courthouse |
  | "When I was a kid..." | CHILDHOOD_FLASHBACK | Young mother + child |
  | "My mom worked two jobs" | CHILDHOOD_FLASHBACK | Young mother at work |
  | "I became a carpenter" | ADULT_FLASHBACK | Adult narrator working |
  | "I built my house" | ADULT_FLASHBACK | Construction scene |
  | "I believed her" | EMOTIONAL_BEAT | Close-up narrator face |
  | "Hit like button" | YOUTUBE_CTA | Narrator to camera |

  OUTPUT: JSON object, NO markdown.

# =============================================================================
# CAMERA REFERENCE
# =============================================================================

camera_reference:
  shot_types:
    "Extreme Wide Shot (EWS)": "Environment dominant, tiny subject"
    "Wide Shot (WS)": "Full body + environment"
    "Medium Shot (MS)": "Waist up"
    "Medium Close-up (MCU)": "Chest up"
    "Close-up (CU)": "Face fills frame"
    "Extreme Close-up (ECU)": "Part of face/detail"
    "Over-the-shoulder (OTS)": "Behind one person looking at another"
    "Two-shot": "Two people in frame"

  angles:
    "Eye-level": "Neutral, viewer = observer"
    "Low angle": "Subject has power, heroic"
    "High angle": "Subject vulnerable, small"
    "Dutch tilt": "Unease, tension"
    "Over-the-shoulder": "Connection, conversation"

  lenses:
    "24mm": "Wide - Establishing, environments"
    "35mm": "Wide normal - Full body, groups"
    "50mm": "Normal - Dialogue, versatile"
    "85mm": "Portrait - Face detail, interviews"
    "100mm": "Macro - Details, hands, objects"

# =============================================================================
# END v5.0
# =============================================================================
