# =============================================================================
# UNI-X VOICE TO VIDEO - PROMPTS CONFIGURATION v5.0 (AI PRODUCTION DIRECTOR)
# =============================================================================
# Theo chuan AI Production Director voi 3-Step Workflow:
# - Step 1: PACING & SLICING (segment text 8-20 words)
# - Step 2: DIRECTOR'S VISUAL BLUEPRINT (scene direction)
# - Step 3: PRODUCTION EXECUTION (assets + scene JSON)
#
# OUTPUT: JSON thuan, de parse va su dung
# =============================================================================

# =============================================================================
# GLOBAL STYLE DEFINITION (MASTER STRING - PASTE NGUYEN VAN)
# =============================================================================

global_style_string: "Cinematic, 4K photorealistic, shot on Arri Alexa, soft film grain, High Key Lighting, Balanced Exposure, well-lit, soft fill light, no crushing shadows, highly detailed texture, professional color grading"

visual_clarity_string: "Face illuminated by soft volumetric light, clear facial features, high visibility"

negative_prompt_string: "cartoon, 3d render, text, watermark, bad anatomy, distorted face, very dark image, underexposed, wrong face, different character, inconsistent appearance"

# =============================================================================
# STEP 1 + 2: ANALYZE STORY (Director's Vision + Character + Location Bible)
# =============================================================================
# Input: {story_text}
# Output: JSON voi world_setting, characters, locations
# =============================================================================

analyze_story: |
  Ban la AI Production Director (Dao dien). Phan tich kich ban va tao Production Kit.

  ## INPUT SCRIPT:
  ---
  {story_text}
  ---

  ## NHIEM VU - LAM THEO THU TU:

  ### BUOC 1: DIRECTOR'S VISION (PHAN TICH THE GIOI CAU CHUYEN TRUOC!)
  Doc ky cau chuyen va xac dinh:
  - **Era (Thoi dai)**: Hien dai? 1990s? 1970s? Thoi phong kien?
  - **Setting (Moi truong)**: Thanh thi? Nong thon? Mien nui? Ven bien?
  - **Social class (Tang lop)**: Giau co? Trung luu? Ngheo kho? Nong dan?
  - **Tone (Tone mau)**: Am ap? Lanh leo? U am? Tuoi sang?
  - **Region (Vung mien)**: Mien Bac? Mien Trung? Mien Nam? Tay Nguyen?

  TU WORLD SETTING NAY → Quyet dinh PHONG CACH cho nhan vat va boi canh!

  ### BUOC 2: CHARACTER BIBLE ("Cast" nhan vat PHU HOP voi the gioi)
  - Moi nhan vat PHAI phu hop voi world setting da xac dinh
  - Neu truyen nong thon ngheo → nhan vat mac ao ba ba, da ngam, toc gian di
  - Neu truyen thanh thi hien dai → nhan vat mac ao so mi, da sang, toc thoi trang
  - Neu truyen thoi xua → nhan vat mac ao dai/ao tu than, toc bui/tet

  ### BUOC 3: LOCATION BIBLE ("Scout" boi canh PHU HOP voi the gioi)
  - Moi boi canh PHAI phu hop voi world setting da xac dinh
  - Neu truyen nong thon → nha la, duong dat, dong lua, ao ca
  - Neu truyen thanh thi → chung cu, van phong, quan cafe, duong nhua
  - Neu truyen thoi xua → nha go, san dinh, chua chien

  ### BUOC 4: KEY OBJECTS (Chi liet ke neu co vat the dac biet)

  ## OUTPUT FORMAT - PURE JSON (khong markdown):
  ## IMPORTANT: ALL names MUST be in ENGLISH (not Vietnamese)!
  ## IMPORTANT: Create MULTIPLE character ages and ALL locations for visual variety!

  {{
    "production_info": {{
      "title": "Story Title",
      "genre": "Drama/Comedy/etc",
      "total_characters": 6,
      "total_locations": 7
    }},

    "world_setting": {{
      "era": "Present day 2020s (with 1990s flashbacks)",
      "setting": "Small town Ohio, USA",
      "social_class": "Working class",
      "tone": "Dramatic, emotional, nostalgic",
      "region": "American Midwest",
      "visual_style": "Natural lighting, realistic tones, warm nostalgia for flashbacks"
    }},

    "global_style": "Cinematic, 4K photorealistic, shot on Arri Alexa, soft film grain, natural American suburban lighting",

    "context_lock": "Small town Ohio, working class, courthouse present day, 1990s apartment flashbacks",

    "characters": [
      {{
        "id": "nvc",
        "name": "Narrator - Present (Dane)",
        "role": "main",
        "age": 30,
        "gender": "male",
        "is_child": false,
        "timeline": "PRESENT",
        "filename": "nvc.png",
        "portrait_prompt": "A cinematic portrait, straight-on medium close-up shot on 85mm lens. Subject is a 30-year-old Caucasian man with short brown hair, tired blue eyes, light stubble, fair skin showing stress and worry. Looking directly at camera with neutral expression. Bright studio lighting, fully illuminated face. Pure white studio background. Wearing simple gray t-shirt. 8K, sharp focus, photorealistic.",
        "character_lock": "30-year-old Caucasian man, short brown hair, tired blue eyes, light stubble, stressed expression, wearing simple gray t-shirt"
      }},
      {{
        "id": "nvc_young",
        "name": "Narrator - Young Adult (Dane at 25)",
        "role": "main",
        "age": 25,
        "gender": "male",
        "is_child": false,
        "timeline": "ADULT_FLASHBACK",
        "filename": "nvc_young.png",
        "portrait_prompt": "A cinematic portrait, straight-on medium close-up shot on 85mm lens. Subject is a 25-year-old Caucasian man with short brown hair, bright blue eyes, clean shaven, healthy tan skin from outdoor work. Looking directly at camera with neutral expression. Bright studio lighting, fully illuminated face. Pure white studio background. Wearing dusty work shirt, construction worker appearance. 8K, sharp focus, photorealistic.",
        "character_lock": "25-year-old Caucasian man, short brown hair, bright blue eyes, clean shaven, healthy tan, wearing dusty work shirt"
      }},
      {{
        "id": "nvc1",
        "name": "Narrator - Child (Dane at 8)",
        "role": "supporting",
        "age": 8,
        "gender": "male",
        "is_child": true,
        "timeline": "CHILDHOOD_FLASHBACK",
        "filename": "NONE",
        "portrait_prompt": "DO_NOT_GENERATE",
        "character_lock": "8-year-old Caucasian boy, messy brown hair, innocent blue eyes, freckles, wearing old faded t-shirt and worn jeans"
      }},
      {{
        "id": "nv1",
        "name": "Mother - Present (Gloria at 55)",
        "role": "supporting",
        "age": 55,
        "gender": "female",
        "is_child": false,
        "timeline": "PRESENT",
        "filename": "nv1.png",
        "portrait_prompt": "A cinematic portrait, straight-on medium close-up shot on 85mm lens. Subject is a 55-year-old Caucasian woman with graying blonde hair in messy ponytail, tired hazel eyes, deep wrinkles, worn weathered face. Looking directly at camera with neutral expression. Bright studio lighting. Pure white studio background. Wearing old cardigan. 8K, sharp focus, photorealistic.",
        "character_lock": "55-year-old Caucasian woman, graying blonde hair in messy ponytail, tired hazel eyes, deep wrinkles, weathered face, wearing old cardigan"
      }},
      {{
        "id": "nv1_young",
        "name": "Mother - Young (Gloria at 32)",
        "role": "supporting",
        "age": 32,
        "gender": "female",
        "is_child": false,
        "timeline": "CHILDHOOD_FLASHBACK",
        "filename": "nv1_young.png",
        "portrait_prompt": "A cinematic portrait, straight-on medium close-up shot on 85mm lens. Subject is a 32-year-old Caucasian woman with blonde hair in tired ponytail, warm hazel eyes with dark circles, young but exhausted face, slight smile. Looking directly at camera with neutral expression. Bright studio lighting. Pure white studio background. Wearing faded blue work uniform. 8K, sharp focus, photorealistic.",
        "character_lock": "32-year-old Caucasian woman, blonde hair in ponytail, warm hazel eyes with dark circles, tired but caring face, wearing faded blue work uniform"
      }},
      {{
        "id": "nv2",
        "name": "Father (mentioned, left)",
        "role": "minor",
        "age": 30,
        "gender": "male",
        "is_child": false,
        "timeline": "CHILDHOOD_FLASHBACK",
        "filename": "nv2.png",
        "portrait_prompt": "A cinematic portrait, straight-on medium close-up shot on 85mm lens. Subject is a 30-year-old Caucasian man with dark brown hair, distant blue eyes, slight beard, cold detached expression. Looking directly at camera with neutral expression. Bright studio lighting. Pure white studio background. Wearing plain jacket. 8K, sharp focus, photorealistic.",
        "character_lock": "30-year-old Caucasian man, dark brown hair, distant blue eyes, slight beard, cold expression, wearing plain jacket"
      }}
    ],

    "locations": [
      {{
        "id": "loc_courthouse",
        "name": "Courthouse Steps (FRAME)",
        "filename": "loc_courthouse.png",
        "timeline": "PRESENT",
        "location_prompt": "Exterior wide shot of small town American courthouse. Empty, no people. Gray stone steps leading up, white classical columns, American flag on pole, official building facade, overcast cloudy sky. Cinematic, 4K photorealistic. 8K.",
        "location_lock": "Small town American courthouse exterior, gray stone steps, white columns, American flag, overcast sky",
        "lighting_default": "Overcast natural daylight, soft diffused shadows"
      }},
      {{
        "id": "loc_apartment",
        "name": "Small Apartment Living Room",
        "filename": "loc_apartment.png",
        "timeline": "CHILDHOOD_FLASHBACK",
        "location_prompt": "Interior wide shot of cramped 1990s American apartment living room. Empty, no people. Thin walls, worn brown carpet, old CRT TV on wooden stand, faded floral sofa, single window with thin curtains, old radiator heater. Warm tungsten lighting. Cinematic, 4K photorealistic. 8K.",
        "location_lock": "1990s cramped apartment living room, worn carpet, old CRT TV, faded sofa, thin curtains, warm tungsten lighting",
        "lighting_default": "Warm tungsten indoor lighting, cozy but poor"
      }},
      {{
        "id": "loc_bedroom",
        "name": "Shared Bedroom",
        "filename": "loc_bedroom.png",
        "timeline": "CHILDHOOD_FLASHBACK",
        "location_prompt": "Interior shot of small 1990s shared bedroom. Empty, no people. Two single beds close together, thin blankets, small nightstand, dim bedside lamp, bare walls, one small window. Dim warm lighting. Cinematic, 4K photorealistic. 8K.",
        "location_lock": "Small 1990s shared bedroom, two beds close together, thin blankets, dim bedside lamp, bare walls",
        "lighting_default": "Dim warm bedside lamp lighting, intimate"
      }},
      {{
        "id": "loc_dryclean",
        "name": "Dry Cleaning Shop",
        "filename": "loc_dryclean.png",
        "timeline": "CHILDHOOD_FLASHBACK",
        "location_prompt": "Interior wide shot of 1990s small town dry cleaning shop. Empty, no people. Industrial pressing machines, racks of hanging clothes in plastic, front counter, fluorescent ceiling lights, steam visible. Cinematic, 4K photorealistic. 8K.",
        "location_lock": "1990s dry cleaning shop interior, pressing machines, clothes racks, fluorescent lights, steam",
        "lighting_default": "Harsh fluorescent lighting, industrial feel"
      }},
      {{
        "id": "loc_convenience",
        "name": "Convenience Store (Night)",
        "filename": "loc_convenience.png",
        "timeline": "CHILDHOOD_FLASHBACK",
        "location_prompt": "Interior shot of late-night convenience store. Empty, no people. Cash register counter, shelves with snacks and drinks, fluorescent lights, parking lot visible through window, night time. Cinematic, 4K photorealistic. 8K.",
        "location_lock": "Late night convenience store, cash register, product shelves, fluorescent lights, parking lot through window, nighttime",
        "lighting_default": "Harsh fluorescent interior, dark outside"
      }},
      {{
        "id": "loc_construction",
        "name": "House Under Construction",
        "filename": "loc_construction.png",
        "timeline": "ADULT_FLASHBACK",
        "location_prompt": "Exterior wide shot of house under construction. Empty, no people. Wooden frame structure, exposed beams, scattered tools, sawdust, suburban lot, sunny day. Cinematic, 4K photorealistic. 8K.",
        "location_lock": "House under construction, wooden frame, exposed beams, tools, sawdust, sunny suburban lot",
        "lighting_default": "Bright sunny daylight, hopeful tone"
      }},
      {{
        "id": "loc_finished_house",
        "name": "Finished House Exterior",
        "filename": "loc_finished_house.png",
        "timeline": "ADULT_FLASHBACK",
        "location_prompt": "Exterior wide shot of modest but new single-story house. Empty, no people. White siding, small front porch, green lawn, suburban neighborhood, sunny day. Cinematic, 4K photorealistic. 8K.",
        "location_lock": "New modest single-story house, white siding, small porch, green lawn, sunny suburban setting",
        "lighting_default": "Bright sunny daylight, proud accomplishment"
      }}
    ],

    "key_objects": [
      {{
        "id": "obj_documents",
        "name": "Legal Documents Folder",
        "filename": "obj_documents.png",
        "object_prompt": "Close-up of thick manila folder stuffed with legal documents and papers, official court stamps visible, worn edges. On gray stone surface. Soft studio lighting. 8K, product photography."
      }}
    ]
  }}

  ## EXAMPLE 2 - Modern Urban Story:
  If story is about city office life:
  - world_setting.setting = "Modern New York City"
  - characters: wearing suits, business casual
  - locations: glass office buildings, upscale apartments, coffee shops

  ## EXAMPLE 3 - Historical Story:
  If story is set in the past:
  - world_setting.era = "1950s America"
  - characters: period-appropriate clothing
  - locations: period-accurate buildings, cars, decor

  ## MANDATORY RULES:
  1. ALL "name" fields MUST be in ENGLISH (e.g., "Mother", "Courthouse", NOT "Me", "Toa an")
  2. ALL prompts MUST be in ENGLISH
  3. Analyze world_setting FIRST before creating characters/locations

  ## CRITICAL - CHARACTER AGE VERSIONS:
  4. For story narration with flashbacks, create MULTIPLE VERSIONS of main characters:
     - nvc = Narrator PRESENT age
     - nvc_young = Narrator YOUNG ADULT (18-28yo) for adult flashbacks
     - nvc1 = Narrator CHILD (is_child=true, filename=NONE)
     - nv1 = Mother PRESENT age
     - nv1_young = Mother YOUNG (when narrator was child, ~30-35yo)
  5. Each character version needs its own portrait_prompt and character_lock
  6. Add "timeline" field: "PRESENT", "CHILDHOOD_FLASHBACK", "ADULT_FLASHBACK"

  ## CRITICAL - EXTRACT ALL LOCATIONS:
  7. Extract EVERY location mentioned in story:
     - Courthouse, apartment, bedroom, dry cleaning shop, convenience store, construction site, finished house, etc.
  8. Each location needs "timeline" field to match when it appears in story
  9. Create at least 5-7 locations for visual variety in a typical story

  ## CHARACTER RULES:
  10. character_lock MUST have: Age + Gender + Face features + Hair + Skin + CLOTHING
  11. portrait_prompt: MUST have "Pure white studio background", "neutral expression", "looking directly at camera"
  12. Children (is_child=true): portrait_prompt = "DO_NOT_GENERATE", filename = "NONE"
  13. ID format: nvc, nvc_young (narrator), nv1, nv1_young, nv2 (others), nvc1 (child narrator)

  ## LOCATION RULES:
  14. location_prompt: MUST have "Empty, no people"
  15. Add lighting_default appropriate for the scene mood
  16. filename uses .png (NOT .jpg)

  ## OUTPUT:
  17. Return pure JSON only, NO markdown code blocks

  ## VISUAL VARIETY CHECK:
  Before returning, verify you have:
  - [ ] At least 2 versions of narrator (present + young/child)
  - [ ] At least 2 versions of mother if she appears in flashbacks (present + young)
  - [ ] At least 5-7 different locations covering all mentioned places
  - [ ] Timeline tags on all characters and locations
  - [ ] Enough variety to make a visually interesting video (not repetitive!)

# =============================================================================
# STEP 2: DIRECTOR'S TREATMENT (Visual Story Plan)
# =============================================================================
# Input: {story_text} - Full story content
# Output: Story structure, emotional arc, visual plan for each part
# THIS STEP IS CRITICAL - Creates the "film blueprint" before individual scenes
# =============================================================================

directors_treatment: |
  You are a Film Director. Read the FULL STORY and create a DIRECTOR'S TREATMENT.
  This is the master plan for how the video will look and feel.

  ## INPUT - FULL STORY:
  ---
  {story_text}
  ---

  ## YOUR TASK:
  Analyze the story like a film director would:
  1. Understand the NARRATIVE STRUCTURE (beginning, middle, end)
  2. Identify EMOTIONAL BEATS (what feelings to evoke at each point)
  3. Plan VISUAL STRATEGY for each part (not every word needs a visual!)
  4. Create a coherent VISUAL NARRATIVE that tells the story effectively

  ## STORY STRUCTURE ANALYSIS:

  ### IDENTIFY THE PARTS:
  Most personal stories have this structure:
  - **HOOK/OPENING**: Grab attention, set up conflict (usually present day)
  - **BACKSTORY**: How we got here (usually flashbacks)
  - **RISING ACTION**: Building toward the conflict
  - **CLIMAX**: The main conflict/confrontation
  - **RESOLUTION**: How it ended, lessons learned

  ### EMOTIONAL ARC:
  Map the emotional journey:
  - Opening: Tension, curiosity, hook
  - Backstory: Warmth, nostalgia, sympathy
  - Rising: Hope, determination, pride
  - Climax: Betrayal, shock, pain
  - Resolution: Justice, closure, reflection

  ## OUTPUT FORMAT - JSON:

  {{
    "story_analysis": {{
      "title": "Mother's Betrayal",
      "genre": "Personal Drama",
      "total_duration_estimate": "30 minutes",
      "main_theme": "Family betrayal and self-reliance",
      "emotional_core": "A son's love betrayed by the mother he sacrificed for"
    }},

    "story_parts": [
      {{
        "part_number": 1,
        "part_name": "THE HOOK",
        "time_range": "00:00 - 00:45",
        "content_summary": "Narrator sits on courthouse steps, reveals mother took him to court for his house",
        "emotional_tone": "Tension, disbelief, hook the audience",
        "visual_strategy": "PRESENT DAY - Focus on narrator's distress, courthouse setting, legal documents",
        "key_visuals": [
          "Narrator on courthouse steps, shaking hands holding documents",
          "Close-ups of worried face",
          "Wide shot of imposing courthouse"
        ],
        "pacing": "Slow, contemplative, building tension"
      }},
      {{
        "part_number": 2,
        "part_name": "CHILDHOOD MEMORIES",
        "time_range": "00:46 - 02:00",
        "content_summary": "Growing up poor in Ohio, father left, mother worked two jobs, shared bedroom",
        "emotional_tone": "Warmth, nostalgia, sympathy for mother's sacrifice",
        "visual_strategy": "WARM FLASHBACKS - Young mother working hard, intimate mother-son moments",
        "key_visuals": [
          "Young mother at dry cleaning shop, pressing shirts",
          "Young mother at convenience store at night",
          "Mother coming home exhausted, feet swollen",
          "Mother and child in small apartment",
          "Shared bedroom, mother crying quietly"
        ],
        "pacing": "Gentle, nostalgic, building emotional connection"
      }},
      {{
        "part_number": 3,
        "part_name": "BUILDING THE DREAM",
        "time_range": "02:01 - 03:30",
        "content_summary": "Narrator becomes carpenter, saves money, buys land, builds house with own hands",
        "emotional_tone": "Hope, determination, pride, accomplishment",
        "visual_strategy": "HOPEFUL FLASHBACKS - Young adult working hard, construction scenes",
        "key_visuals": [
          "Young narrator working as carpenter",
          "Empty land plot",
          "Construction in progress, hammering, building",
          "Finished house, moment of pride"
        ],
        "pacing": "Uplifting, determined, building toward success"
      }},
      {{
        "part_number": 4,
        "part_name": "THE BETRAYAL",
        "time_range": "03:31 - 05:00",
        "content_summary": "Mother demands house, takes narrator to court, claims ownership",
        "emotional_tone": "Shock, betrayal, disbelief, pain",
        "visual_strategy": "CONTRAST - Happy moments with mother vs courtroom confrontation",
        "key_visuals": [
          "Mother's cold expression",
          "Courtroom setting",
          "Narrator's shocked face",
          "Legal documents, evidence"
        ],
        "pacing": "Tense, dramatic, building to climax"
      }},
      {{
        "part_number": 5,
        "part_name": "RESOLUTION",
        "time_range": "05:01 - end",
        "content_summary": "Court decision, narrator wins/loses, lessons learned",
        "emotional_tone": "Justice, closure, reflection, moving forward",
        "visual_strategy": "PRESENT DAY - Return to courthouse, final reflection",
        "key_visuals": [
          "Courtroom verdict moment",
          "Narrator's reaction",
          "Walking away from courthouse",
          "Final reflective shot"
        ],
        "pacing": "Resolution, emotional payoff, closure"
      }}
    ],

    "visual_guidelines": {{
      "frame_narrative_location": "Courthouse steps - return here for reflections and present-day thoughts",
      "flashback_style": "Warm color grading for childhood, brighter for adult achievements",
      "narration_scenes": "When narrator just talks (no action), show: close-up face, hands on documents, or location establishing shots",
      "action_scenes": "When story describes specific events, show the action",
      "emotional_beats": "Use close-ups for emotional moments, wide shots for establishing context",
      "do_not_illustrate": [
        "YouTube CTAs (like/subscribe) - just show narrator speaking",
        "Pure opinion statements - show narrator reflecting",
        "Transitions/filler sentences - continue previous scene"
      ]
    }},

    "scene_mapping_guide": {{
      "when_narrator_says_I_am": "PRESENT - show narrator at frame location",
      "when_narrator_says_I_was_when_I_was": "FLASHBACK - show past scene with appropriate characters",
      "when_narrator_describes_action": "SHOW the action happening",
      "when_narrator_expresses_feeling": "CLOSE-UP of narrator's face reflecting",
      "when_narrator_asks_audience": "NARRATOR to camera at frame location"
    }}
  }}

  ## CRITICAL RULES:
  1. UNDERSTAND THE WHOLE STORY before planning visuals
  2. NOT every sentence needs a unique visual - some continue the previous scene
  3. Emotional arc should be CLEAR in the visual treatment
  4. Plan for VARIETY - different locations, different shot types, different moods
  5. The video should FEEL like a film, not a slideshow of unrelated images

  OUTPUT: JSON object with complete director's treatment, NO markdown.

# =============================================================================
# STEP 3: SCENE PRODUCTION (Tao prompt cho tung scene)
# =============================================================================
# Input: {characters_info}, {locations_info}, {pacing_script}, {global_style}
# Output: JSON array cua scenes
# =============================================================================

generate_scenes: |
  Ban la AI Film Director. DICH loi ke thanh HINH ANH ke chuyen (visual storytelling).

  ## NGUYEN TAC SO 1: DICH, KHONG XOA!

  Nguoi ke NOAN cau chuyen. Ban phai TAO HINH ANH THE HIEN cau chuyen do!
  KHONG chi mo ta "nguoi dung" - phai CHO THAY noi dung cau chuyen!

  ### VI DU DICH NARRATION → VISUAL:

  | Loi ke (SRT text) | SAI (generic) | DUNG (ke chuyen) |
  |-------------------|---------------|------------------|
  | "Toi 28 tuoi, tiet kiem du tien mua dat" | "Man standing" | "28yo man dung giua manh dat trong, tay cam giay to dat, cuoi tu hao, hoang hon phia sau" |
  | "Me lam 2 cong viec de nuoi toi" | "Woman working" | "32yo me met moi van hanh may ep ao, mo hoi tran, dong phuc cu nat, dong ho chi 9PM" |
  | "Toi xay nha bang chinh doi tay minh" | "Man with tools" | "28yo man dong dinh vao khung go, mun cua tren mat, bung dung cu, nha dang xay phia sau" |

  ## NGUYEN TAC SO 2: KHONG DUOC DUNG TEXT/DIALOGUE TRONG IMG_PROMPT!
  - img_prompt CHI MO TA HINH ANH
  - TUYET DOI KHONG copy loi ke vao prompt
  - "By the time I was 28..." → KHONG DUOC! Se tao chu tren anh!

  ### 1. SCENE LA HANH DONG, KHONG PHAI PORTRAIT:
  - Nhan vat DANG LAM GI DO - khong phai dung pose
  - KHONG BAO GIO nhin thang vao camera
  - KHONG dung "looking at camera", "facing viewer", "portrait"
  - Mo ta HANH DONG: dang di, dang noi, dang nghi, dang lam viec...

  ### 2. SU DUNG THAM CHIEU DUNG CACH:
  - **character_lock**: Chi dung MO TA NGOAI HINH (tuoi, toc, mat, quan ao)
  - KHONG copy phan "looking at camera" tu portrait prompt
  - Them HANH DONG vao sau mo ta ngoai hinh
  - Vi du: "Minh, 32 tuoi, toc den ngan... DANG NGOI DOC SACH"

  ### 3. MOI SCENE = 1 KHOANH KHAC:
  - Moi scene trong input = 1 scene output
  - Mo ta KHOANH KHAC cu the trong cau chuyen

  ### 4. LOCATION + LIGHTING:
  - **location_lock**: COPY NGUYEN VAN lam background
  - Them anh sang phu hop voi thoi diem trong ngay

  ### 5. GLOBAL STYLE INJECTION:
  - Ket thuc moi img_prompt bang global_style string

  ## INPUT DATA:
  **GLOBAL_STYLE:** {global_style}

  **CHARACTERS (Chi dung phan mo ta ngoai hinh, BO QUA "looking at camera"):**
  {characters_info}

  **LOCATIONS (Dung location_lock nguyen van):**
  {locations_info}

  **SCENES (Noi dung can tao prompt - TAP TRUNG VAO HANH DONG):**
  (Moi scene da co Location - PHAI dung location_id do cho location_used!)
  {scenes_info}

  ## OUTPUT FORMAT - JSON ARRAY:

  Tra ve JSON object voi key "scenes" chua array:

  {{
    "scenes": [
      {{
        "scene_id": 1,
        "characters_used": ["nv1"],
        "location_used": "loc1",
        "reference_files": ["nv1.png", "loc1.png"],
        "img_prompt": "Wide shot, 24mm lens. Minh, 32-year-old Vietnamese man with short black side-parted hair, oval face, light tan skin, wearing navy blue polo shirt, WALKING SLOWLY toward the window, his back partially turned to viewer. Modern apartment living room, beige sofa, wooden coffee table, large window with city view, warm afternoon sunlight streaming in. Cinematic, 4K photorealistic, shot on Arri Alexa, soft film grain, natural lighting.",
        "video_prompt": "Slow tracking shot following Minh as he walks to window."
      }},
      {{
        "scene_id": 2,
        "characters_used": ["nv1", "nv2"],
        "location_used": "loc1",
        "reference_files": ["nv1.png", "nv2.png", "loc1.png"],
        "img_prompt": "Over-the-shoulder shot from behind Lan, 50mm lens. Minh, 32-year-old Vietnamese man with short black side-parted hair, sitting on beige sofa, LEANING FORWARD while speaking, hands gesturing. In soft focus foreground: back of Lan's head, long black hair. Two people in conversation. Modern apartment living room, warm afternoon light. Cinematic, 4K photorealistic, natural lighting.",
        "video_prompt": "Minh speaks animatedly, hands moving to emphasize points."
      }},
      {{
        "scene_id": 3,
        "characters_used": ["nv1"],
        "location_used": "loc1",
        "reference_files": ["nv1.png", "loc1.png"],
        "img_prompt": "Extreme close-up, 100mm macro lens. Minh's hands CLENCHING into fists on his lap, knuckles whitening, wedding ring visible. Shallow depth of field. Warm afternoon lighting. Cinematic, 4K photorealistic.",
        "video_prompt": "The hands slowly tighten, tension building."
      }}
    ]
  }}

  ## HANH DONG GUIDE (Thay vi pose):
  - Sad/Thinking: nhin ra cua so, cui dau, tay om mat
  - Happy: cuoi voi nguoi khac, om, bat tay
  - Angry: nam dam, dung day, quay lung
  - Talking: nghieng nguoi, dua tay, nhin nguoi doi dien
  - Walking: dang buoc di, lung quay lai
  - Working: dang viet, dang doc, dang lam viec

  ## KHONG DUOC LAM:
  - KHONG: "looking at camera", "facing viewer", "portrait shot"
  - KHONG: "neutral expression", "standing straight"
  - KHONG: nhan vat dung yen khong lam gi
  - KHONG BAO GIO: dua dialogue/narration/subtitle text vao img_prompt!
  - KHONG: copy scene text truc tiep vao prompt (se tao ra text tren anh!)

  ## QUY TAC VANG:
  img_prompt = CHARACTER_DESCRIPTION + ACTION + LOCATION + LIGHTING + STYLE
  img_prompt != dialogue != narration != subtitle

  OUTPUT: JSON object voi key "scenes", KHONG co markdown code block.

# =============================================================================
# STEP 2.5: SMART SCENE DIVISION (Chia scene theo noi dung)
# =============================================================================
# Input: {srt_with_timestamps}, {directors_treatment}, {characters_info}, {locations_info}
# Output: JSON array cua scenes duoc chia theo noi dung
# THIS STEP uses the Director's Treatment to guide scene creation!
# =============================================================================

smart_divide_scenes: |
  You are an AI Director creating a FILM from narration. Your job is to TRANSLATE spoken words into VISUAL STORYTELLING.

  ## CRITICAL CONCEPT: NARRATION → VISUAL TRANSLATION

  The narrator SPEAKS the story. You must CREATE the VISUALS that SHOW the story.
  DO NOT just describe "man standing". SHOW what the narration is ABOUT!

  ### TRANSLATION EXAMPLES:

  | Narration (what narrator says) | BAD Visual (generic) | GOOD Visual (story-telling) |
  |-------------------------------|---------------------|----------------------------|
  | "By the time I was 28, I saved enough to buy land" | "Man standing" | "28yo man standing proudly on empty grass lot, holding property deed, hopeful smile, surveying his new land" |
  | "My mother worked two jobs" | "Woman at work" | "Exhausted 32yo mother in faded work uniform, pressing shirts at dry cleaning machine, sweat on brow, late evening" |
  | "She would come home smelling like detergent" | "Woman at door" | "Tired mother entering small apartment, 8yo boy running to hug her, her work clothes wrinkled, warm loving embrace" |
  | "I built the house with my own hands" | "Man with tools" | "Muscular 25yo man hammering wooden beam on house frame, sawdust in hair, proud determined expression, golden hour sunlight" |
  | "She took me to court for my house" | "Man at courthouse" | "30yo man sitting defeated on courthouse steps, crumpled legal papers in trembling hands, mother visible through courthouse doors behind him" |
  | "It cost me $72,000 - every penny I had earned" | "Man with money" | "Close-up of calloused working hands counting worn dollar bills, years of savings visible in weathered wallet, bittersweet moment" |

  ## DIRECTOR'S TREATMENT (Your Visual Blueprint):
  ---
  {directors_treatment}
  ---

  ## CHARACTERS AND LOCATIONS:
  {characters_info}

  {locations_info}

  ## INPUT - SRT Segments (max 8s each):
  ---
  {srt_with_timestamps}
  ---

  ## YOUR TASK:
  For EACH SRT segment:
  1. UNDERSTAND what the narration is ABOUT (not just the words)
  2. CREATE a visual that SHOWS that meaning
  3. Include SPECIFIC ACTIONS, EMOTIONS, DETAILS

  ## SCENE TYPE CLASSIFICATION:

  ### 1. FRAME_PRESENT (Return to this often!)
  When narrator describes their CURRENT situation:
  - "I am sitting on the courthouse steps right now"
  - "She thought she would win"
  - "She had no idea what I had been saving"
  → Show: Narrator in PRESENT location (courthouse steps), contemplative or speaking
  → Character: Current age (30 years old)

  ### 2. CHILDHOOD_FLASHBACK
  Memories from childhood (ages 4-12):
  - "When I was a kid..."
  - "My mother used to..."
  - "I remember lying in bed..."
  - "She would come home smelling like detergent"
  → Show: YOUNG mother (30-35yo) + CHILD narrator (4-12yo)
  → Location: Apartment, dry cleaning shop, convenience store (from that era)
  → Warm, nostalgic lighting

  ### 3. ADULT_FLASHBACK
  Memories from young adulthood (ages 18-28):
  - "After high school I learned a trade"
  - "I became a carpenter"
  - "I built my own house"
  → Show: ADULT narrator (25-28yo) working, building
  → Location: Construction site, land, etc.
  → Determined, hopeful tone

  ### 4. EMOTIONAL_BEAT
  Pure emotional reflection (no specific scene described):
  - "You are everything to me. And I believed her."
  - "I believed every word."
  - "I would make her proud."
  → Show: Close-up of narrator's face in FRAME location, reflective expression
  → Or: Symbolic shot (hands, documents, etc.)
  → DO NOT invent random scenes!

  ### 5. YOUTUBE_CTA
  Meta content not part of story:
  - "Hit that like button and subscribe"
  - "Let me know in the comments"
  → Show: Narrator speaking directly (medium shot, frame location)
  → Keep it simple, don't create elaborate scenes

  ## NEW LOCATIONS TO CREATE:
  Based on story content, you may need to create:
  - loc_dryclean: "1990s small town dry cleaning shop, pressing machines, racks of clothes, fluorescent lights"
  - loc_convenience: "Late night convenience store, cash register, fluorescent lights, parking lot visible"
  - loc_construction: "House under construction, wooden frame, tools, sawdust, outdoor setting"
  - loc_land: "Empty plot of land, grass, trees, suburban outskirts"
  - loc_bedroom: "Small shared bedroom in apartment, two beds close together, dim light"

  ## OUTPUT FORMAT - JSON:

  {{
    "story_timeline": {{
      "frame_location": "courthouse steps",
      "narrator_current_age": 30,
      "childhood_period": "4-12 years old, 1990s",
      "adult_period": "18-28 years old, 2010s"
    }},
    "new_locations": [
      {{
        "id": "loc_dryclean",
        "name": "Dry Cleaning Shop",
        "location_lock": "1990s small town dry cleaning shop, industrial pressing machines, racks of hanging clothes, fluorescent lighting"
      }},
      {{
        "id": "loc_construction",
        "name": "House Construction Site",
        "location_lock": "House under construction, wooden frame structure, scattered tools, sawdust, sunny outdoor setting"
      }}
    ],
    "scenes": [
      {{
        "scene_id": 1,
        "srt_text": "My mother took me to court to take away the house I built with my own hands.",
        "scene_type": "FRAME_PRESENT",
        "location_id": "loc_courthouse",
        "characters_in_scene": ["nvc"],
        "img_prompt": "Medium shot, 50mm lens. 30-year-old Caucasian man with short brown hair, tired blue eyes, light stubble, wearing simple gray t-shirt, SITTING ALONE on cold gray courthouse steps, trembling hands clutching crumpled legal documents, head bowed in disbelief. American courthouse exterior with white columns and flag visible behind. Soft overcast morning light casting long shadow. Cinematic, 4K photorealistic, emotional devastation visible on face."
      }},
      {{
        "scene_id": 2,
        "srt_text": "My mother worked two jobs just to keep us fed.",
        "scene_type": "CHILDHOOD_FLASHBACK",
        "location_id": "loc_dryclean",
        "characters_in_scene": ["nv1_young"],
        "img_prompt": "Medium shot, 35mm lens. 32-year-old Caucasian woman with blonde hair in tired ponytail, warm hazel eyes with dark circles, OPERATING industrial pressing machine with exhausted expression. Steam rising around her tired face, faded blue work uniform stained with sweat. 1990s dry cleaning shop interior, racks of hanging clothes, harsh fluorescent lights overhead, wall clock showing 9PM. Warm nostalgic color grading, cinematic, showing sacrifice of a hardworking mother."
      }},
      {{
        "scene_id": 3,
        "srt_text": "She would come home late at night, her feet swollen from standing all day.",
        "scene_type": "CHILDHOOD_FLASHBACK",
        "location_id": "loc_apartment",
        "characters_in_scene": ["nv1_young", "nvc1"],
        "img_prompt": "Wide shot, 24mm lens. 32-year-old blonde mother in faded work uniform LIMPING through small apartment door at midnight, kicking off worn shoes revealing swollen feet. 8-year-old boy in pajamas RUNNING to embrace her with open arms. 1990s cramped apartment, worn carpet, single lamp providing warm tungsten glow. Emotional reunion moment, love despite exhaustion, cinematic warm color grading."
      }},
      {{
        "scene_id": 4,
        "srt_text": "By the time I was 28, I had saved enough to buy a small piece of land.",
        "scene_type": "ADULT_FLASHBACK",
        "location_id": "loc_land",
        "characters_in_scene": ["nvc_young"],
        "img_prompt": "Wide shot, 24mm lens. 28-year-old Caucasian man with short brown hair, bright blue eyes, clean shaven, healthy tan, wearing dusty work clothes, STANDING PROUDLY in center of empty grass lot on suburban outskirts. Holding property deed document raised triumphantly in hand, huge genuine smile of accomplishment. FOR SALE sign with SOLD sticker visible. Golden sunset backlighting, American dream achieved moment, hopeful cinematic atmosphere."
      }},
      {{
        "scene_id": 5,
        "srt_text": "I built the house with my own two hands. Every nail, every board.",
        "scene_type": "ADULT_FLASHBACK",
        "location_id": "loc_construction",
        "characters_in_scene": ["nvc_young"],
        "img_prompt": "Medium shot, 50mm lens. Muscular 28-year-old man with tan skin and determined expression, SWINGING HAMMER driving nail into wooden beam. Sawdust covering his sweaty face, tool belt heavy around waist, work gloves worn. Half-finished wooden house frame structure behind him. Bright sunny day, golden hour light, pride and determination in every muscle. Cinematic, showing years of hard work paying off."
      }},
      {{
        "scene_id": 6,
        "srt_text": "You are everything to me. And I believed her.",
        "scene_type": "EMOTIONAL_BEAT",
        "location_id": "loc_courthouse",
        "characters_in_scene": ["nvc"],
        "img_prompt": "Extreme close-up, 85mm lens. 30-year-old man's eyes GLISTENING with tears, single tear rolling down weathered cheek. Shallow depth of field, courthouse steps blurred in background. Eyes have distant, unfocused gaze of someone lost in painful memory of betrayal. Soft natural light, raw emotional vulnerability, cinematic intimate moment capturing heartbreak."
      }}
    ]
  }}

  ## CRITICAL RULES:
  1. **ALWAYS identify the timeline** - Is this present, childhood memory, or adult memory?
  2. **Use correct character ages** - Mother in childhood memories = 30-35yo, NOT 55yo
  3. **Return to FRAME location** for emotional beats and reflections
  4. **Create specific locations** for actions mentioned (dry cleaning, convenience store, construction)
  5. **Don't invent random scenes** - If text is reflective, show reflection, not random action
  6. **YouTube CTAs** - Keep simple, narrator speaking to camera

  ## VISUAL RICHNESS CHECKLIST (Every visual_moment MUST have):
  - [ ] SPECIFIC ACTION (not just "standing" - what are they DOING?)
  - [ ] EMOTION (what feeling shows on face/body?)
  - [ ] DETAILS (props, clothing state, environment details)
  - [ ] LIGHTING/TIME (morning, evening, harsh fluorescent, warm tungsten)
  - [ ] STORY CONTEXT (why is this moment important?)

  BAD: "Man at construction site"
  GOOD: "Sweaty 28yo man triumphantly placing final roof beam, arms raised in celebration, finished house visible below, sunset golden light, years of hard work finally complete"

  ## GOLDEN RULE - TRANSLATE, DON'T REMOVE:
  7. **visual_moment = VISUAL TRANSLATION of narration**
     - READ the narration: "By the time I was 28, I saved enough to buy land"
     - UNDERSTAND the meaning: Achievement, pride, years of saving paying off
     - CREATE the visual: "Proud 28yo man holding deed, standing on his new land, huge smile, golden sunset"
     - NEVER just put text OR generic descriptions!

  WORST: "By the time I was 28 years old I saved money..." (text in prompt = subtitles on image!)
  BAD: "Man standing on land" (generic, no story)
  GOOD: "Proud 28yo man holding property deed, standing center of empty lot, tears of joy, American dream achieved"

  ## MAPPING GUIDE:
  | Content Type | Scene Type | Visual |
  |-------------|-----------|--------|
  | "I am sitting..." | FRAME_PRESENT | Narrator at courthouse |
  | "When I was a kid..." | CHILDHOOD_FLASHBACK | Young mother + child |
  | "My mom worked two jobs" | CHILDHOOD_FLASHBACK | Young mother at work |
  | "I became a carpenter" | ADULT_FLASHBACK | Adult narrator working |
  | "I built my house" | ADULT_FLASHBACK | Construction scene |
  | "I believed her" | EMOTIONAL_BEAT | Close-up narrator face |
  | "Hit like button" | YOUTUBE_CTA | Narrator to camera |

  OUTPUT: JSON object, NO markdown.

# =============================================================================
# CAMERA REFERENCE
# =============================================================================

camera_reference:
  shot_types:
    "Extreme Wide Shot (EWS)": "Environment dominant, tiny subject"
    "Wide Shot (WS)": "Full body + environment"
    "Medium Shot (MS)": "Waist up"
    "Medium Close-up (MCU)": "Chest up"
    "Close-up (CU)": "Face fills frame"
    "Extreme Close-up (ECU)": "Part of face/detail"
    "Over-the-shoulder (OTS)": "Behind one person looking at another"
    "Two-shot": "Two people in frame"

  angles:
    "Eye-level": "Neutral, viewer = observer"
    "Low angle": "Subject has power, heroic"
    "High angle": "Subject vulnerable, small"
    "Dutch tilt": "Unease, tension"
    "Over-the-shoulder": "Connection, conversation"

  lenses:
    "24mm": "Wide - Establishing, environments"
    "35mm": "Wide normal - Full body, groups"
    "50mm": "Normal - Dialogue, versatile"
    "85mm": "Portrait - Face detail, interviews"
    "100mm": "Macro - Details, hands, objects"

# =============================================================================
# END v5.0
# =============================================================================
