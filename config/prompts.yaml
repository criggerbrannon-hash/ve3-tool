# =============================================================================
# UNI-X VOICE TO VIDEO - PROMPTS CONFIGURATION v3.0 (CINEMATIC)
# =============================================================================
# Phiên bản tối ưu cho làm phim:
# - Đồng nhất nhân vật qua tất cả các cảnh (Character Consistency)
# - Ảnh reference chất lượng cao với tiêu chuẩn rõ ràng
# - Đa dạng góc máy như phim chuyên nghiệp
# - Bối cảnh (Setting) được định nghĩa và tái sử dụng
# - Mỗi shot là 1 frame phim với composition riêng
# =============================================================================

# =============================================================================
# PHẦN 1: GLOBAL CINEMATIC STYLE
# =============================================================================

global_style: |
  Cinematic 4K photorealistic, shot on Arri Alexa Mini LF,
  anamorphic lens flare, shallow depth of field, film grain texture,
  Hollywood color grading, high dynamic range, professional three-point lighting,
  razor sharp focus on subject, cinematic aspect ratio 2.39:1,
  highly detailed textures, volumetric atmosphere.

global_lighting: |
  Face illuminated by soft key light with subtle fill,
  rim light for subject separation, catch light in eyes,
  motivated lighting matching scene environment,
  no crushed blacks, visible shadow detail.

negative_prompt_base: |
  cartoon, 3d render, anime, illustration, painting, drawing,
  text, watermark, logo, signature, bad anatomy, distorted face,
  mutation, deformed, ugly, blurry, low resolution, overexposed,
  underexposed, very dark image, heavy shadows, obscured face,
  extra limbs, missing limbs, floating limbs, disconnected limbs,
  duplicate characters, clone, disfigured, gross proportions,
  inconsistent character appearance, wrong clothing, wrong hair color.

# =============================================================================
# PHẦN 2: PHÂN TÍCH CÂU CHUYỆN - TẠO TẤT CẢ NHÂN VẬT
# =============================================================================
# Variables: {story_text}
# =============================================================================

analyze_story: |
  Bạn là AI Film Director chuyên pre-production cho phim điện ảnh.
  Nhiệm vụ: Phân tích kịch bản và tạo Character Bible + Location Bible để đảm bảo TÍNH NHẤT QUÁN 100%.

  ## INPUT - KỊCH BẢN:
  ---
  {story_text}
  ---

  ## NHIỆM VỤ 1: XÁC ĐỊNH TẤT CẢ NHÂN VẬT

  **QUAN TRỌNG:** Phải liệt kê TẤT CẢ nhân vật xuất hiện trong câu chuyện, kể cả:
  - Nhân vật chính (narrator, protagonist)
  - Nhân vật phụ quan trọng
  - Nhân vật phụ ít quan trọng
  - Nhân vật chỉ được nhắc đến/xuất hiện 1-2 lần
  - Nhóm người (nếu là nhóm cụ thể lặp lại)

  **Quy tắc ID:**
  - Nhân vật chính: "nv1"
  - Nhân vật phụ: "nv2", "nv3", "nv4"... (theo thứ tự xuất hiện)
  - KHÔNG giới hạn số lượng - tạo cho TẤT CẢ

  ## NHIỆM VỤ 2: TẠO REFERENCE IMAGE PROMPT

  **Tiêu chuẩn ảnh Reference để AI nhận diện:**

  PHẢI có các yếu tố sau theo THỨ TỰ:
  1. **Shot type**: "Passport-style headshot" hoặc "Upper body portrait"
  2. **Background**: "Pure white studio background #FFFFFF"
  3. **Lighting**: "Flat even studio lighting, no shadows"
  4. **Face detail**: Mô tả cụ thể: hình dạng mặt, mắt, mũi, môi
  5. **Hair**: Màu, kiểu, độ dài, texture
  6. **Skin**: Tông da, đặc điểm (tàn nhang, nốt ruồi...)
  7. **Age markers**: Nếp nhăn, độ già trẻ
  8. **Expression**: "Neutral expression, looking directly at camera"
  9. **Clothing**: Outfit đơn giản, màu sắc cụ thể
  10. **Technical**: "8K, sharp focus, studio photography, no artistic effects"

  **Tại sao cần Pure White Background?**
  - AI image generators (như Ideogram) dễ dàng nhận diện subject
  - Khi dùng làm reference, AI sẽ focus vào face/body features
  - Không bị nhiễu bởi background phức tạp

  ## NHIỆM VỤ 3: TẠO CHARACTER LOCK

  **[CHARACTER_LOCK]** - Chuỗi ngắn gọn để paste vào MỌI scene prompt:
  Format: "[Age] [ethnicity] [gender] with [hair description], [key face feature], wearing [outfit]"

  Ví dụ: "35-year-old Vietnamese man with short black hair and goatee, wearing gray business suit"

  ## NHIỆM VỤ 4: XÁC ĐỊNH LOCATIONS/SETTINGS

  Liệt kê TẤT CẢ các địa điểm xuất hiện trong câu chuyện.
  Mỗi location cần:
  - ID: "loc1", "loc2"...
  - Tên: "Phòng khách nhà Minh", "Văn phòng công ty"...
  - Description: Mô tả chi tiết để dùng lại trong scene prompts

  ## OUTPUT FORMAT - JSON:

  {{
    "story_analysis": {{
      "genre": "Drama/Comedy/Action/etc",
      "time_period": "Modern/1990s/etc",
      "mood": "Warm/Dark/Tense/etc",
      "total_characters": 5,
      "total_locations": 3
    }},

    "context_lock": "Modern Vietnamese urban setting, 2024, natural indoor/outdoor lighting matching time of day",

    "locations": [
      {{
        "id": "loc1",
        "name": "Phòng khách căn hộ",
        "description": "Modern Vietnamese apartment living room, beige sofa, wooden coffee table, large window with city view, warm afternoon sunlight, minimalist decor, potted plants",
        "lighting_default": "Warm natural window light from the right"
      }},
      {{
        "id": "loc2",
        "name": "Văn phòng công ty",
        "description": "Corporate office space, glass partitions, fluorescent ceiling lights, computer monitors, office chairs, neutral gray carpet, cool blue-white lighting"
      }}
    ],

    "characters": [
      {{
        "id": "nv1",
        "role": "main",
        "name": "Minh",
        "age_range": "30-35",
        "gender": "male",
        "ethnicity": "Vietnamese",
        "is_child": false,

        "portrait_prompt": "Passport-style headshot portrait. Pure white studio background #FFFFFF. Flat even studio lighting with no shadows. Subject is a 32-year-old Vietnamese man with an oval face shape, double eyelids, straight nose with slightly wide nostrils, medium-thick lips. Short black hair, side-parted, clean cut. Light tan skin tone, clean-shaven. Neutral expression, looking directly at camera. Wearing a plain navy blue polo shirt. 8K resolution, ultra sharp focus, professional ID photo style, no artistic effects, photorealistic.",

        "character_lock": "32-year-old Vietnamese man with short black side-parted hair, oval face, wearing navy polo shirt",

        "outfit_variations": [
          "navy blue polo shirt",
          "white dress shirt with sleeves rolled up",
          "gray casual t-shirt"
        ],

        "vietnamese_description": "Nam 32 tuổi, tóc đen ngắn chải lệch, mặt trái xoan, da ngăm nhẹ"
      }},
      {{
        "id": "nv2",
        "role": "supporting",
        "name": "Lan",
        "age_range": "28-32",
        "gender": "female",
        "ethnicity": "Vietnamese",
        "is_child": false,

        "portrait_prompt": "Passport-style headshot portrait. Pure white studio background #FFFFFF. Flat even studio lighting with no shadows. Subject is a 30-year-old Vietnamese woman with a round face shape, single eyelids, small nose, full lips with natural pink color. Long straight black hair past shoulders, center-parted. Fair skin tone with slight rosy cheeks. Neutral expression, looking directly at camera. Wearing a simple cream-colored blouse. 8K resolution, ultra sharp focus, professional ID photo style, no artistic effects, photorealistic.",

        "character_lock": "30-year-old Vietnamese woman with long straight black hair, round face, wearing cream blouse",

        "outfit_variations": [
          "cream-colored blouse",
          "light pink cardigan over white top",
          "navy blue office dress"
        ],

        "vietnamese_description": "Nữ 30 tuổi, tóc đen dài thẳng, mặt tròn, da trắng hồng"
      }},
      {{
        "id": "nv3",
        "role": "supporting",
        "name": "Bà Hương",
        "age_range": "55-60",
        "gender": "female",
        "ethnicity": "Vietnamese",
        "is_child": false,

        "portrait_prompt": "Passport-style upper body portrait. Pure white studio background #FFFFFF. Flat even studio lighting with no shadows. Subject is a 58-year-old Vietnamese woman with an oval face, visible smile lines around eyes and mouth, slightly drooping eyelids, gentle expression. Short permed gray-black hair. Medium skin tone with age spots on cheeks. Neutral warm expression, looking directly at camera. Wearing a traditional ao ba ba in muted brown color. 8K resolution, ultra sharp focus, professional portrait style, no artistic effects, photorealistic.",

        "character_lock": "58-year-old Vietnamese woman with short gray-black permed hair, warm face with smile lines, wearing brown ao ba ba",

        "vietnamese_description": "Bà 58 tuổi, tóc ngắn uốn đen xám, mặt hiền với nếp nhăn cười"
      }}
    ],

    "key_objects": [
      {{
        "id": "obj1",
        "name": "Chiếc nhẫn cưới",
        "prompt": "Extreme macro close-up. A simple gold wedding band with slight wear marks, sitting on white marble surface. Soft diffused lighting from above. Shallow depth of field. 8K detail, photorealistic jewelry photography."
      }}
    ]
  }}

  ## QUY TẮC QUAN TRỌNG:
  1. TẤT CẢ portrait_prompt PHẢI có "Pure white studio background #FFFFFF"
  2. TẤT CẢ portrait_prompt PHẢI có "Flat even studio lighting with no shadows"
  3. TẤT CẢ portrait_prompt PHẢI có "Neutral expression, looking directly at camera"
  4. character_lock phải NGẮN GỌN nhưng ĐỦ để nhận diện
  5. Ethnicity mặc định: Vietnamese (trừ khi truyện chỉ định khác)
  6. Chỉ trả về JSON thuần, không markdown code block

# =============================================================================
# PHẦN 3: TẠO SCENE PROMPTS - CINEMATIC SHOTS
# =============================================================================
# Variables: {characters_info}, {scenes_info}, {context_lock}, {global_style}, {locations_info}
# =============================================================================

generate_scenes: |
  Bạn là AI Film Director chuyên tạo shot list cho phim điện ảnh.
  Mỗi scene prompt = 1 shot phim với composition, góc máy, và mood riêng biệt.

  ## GLOBAL CONTEXT:
  **[CONTEXT_LOCK]:** {context_lock}
  **[GLOBAL_STYLE]:** {global_style}
  **[LOCATIONS]:** {locations_info}

  ## THÔNG TIN NHÂN VẬT (ĐÃ CÓ REFERENCE IMAGES):
  {characters_info}

  ## DANH SÁCH CẢNH CẦN TẠO SHOT:
  {scenes_info}

  ---

  ## NGUYÊN TẮC CINEMATIC:

  ### 1. MỖI SCENE = 1 SHOT PHIM RIÊNG BIỆT
  - KHÔNG được 2 scene liền nhau có cùng góc máy + shot type
  - Phải có sự chuyển đổi visual giữa các shot (như trong phim thật)
  - Think like a cinematographer: "Shot này nói gì? Góc máy nào truyền tải emotion?"

  ### 2. SHOT TYPE ROTATION (luân phiên để không nhàm chán):

  | Scene Emotion | Recommended Shots |
  |---------------|-------------------|
  | Establishing/Intro | Wide Shot (WS), Extreme Wide (EWS) |
  | Dialogue | Medium Shot (MS), Over-the-Shoulder (OTS) |
  | Emotion/Reaction | Close-up (CU), Medium Close-up (MCU) |
  | Tension/Drama | Dutch Angle, Low Angle, ECU on eyes/hands |
  | Action | Tracking shot, Wide with movement |
  | Intimate | Shallow DOF close-up, Two-shot |

  ### 3. CAMERA ANGLE VARIETY (QUAN TRỌNG):

  Trong mỗi 5 scenes liên tiếp, PHẢI có ÍT NHẤT:
  - 1 Eye-level shot
  - 1 Low angle OR High angle shot
  - 1 Over-the-shoulder (nếu có dialogue)
  - 1 Wide establishing shot

  **Ý nghĩa góc máy:**
  - Eye-level: Neutral, viewer = observer
  - Low angle (nhìn lên): Subject có power, heroic, imposing
  - High angle (nhìn xuống): Subject vulnerable, small, overwhelmed
  - Dutch tilt (nghiêng): Unease, tension, something wrong
  - Over-the-shoulder: Connection, conversation, POV of one character
  - Bird's eye: God view, pattern, isolation

  ### 4. CHARACTER CONSISTENCY (CỰC KỲ QUAN TRỌNG):

  Mỗi scene prompt PHẢI chứa CHÍNH XÁC character_lock của nhân vật xuất hiện.

  **Format khi có nhân vật:**
  ```
  [Shot type] + [Lens] + [Character_lock CHÍNH XÁC] + [Action/Pose] + [Location description] + [Lighting] + [Mood] + [Technical]
  ```

  **Ví dụ ĐÚNG:**
  "Medium close-up, 50mm lens. A 32-year-old Vietnamese man with short black side-parted hair, oval face, wearing navy polo shirt. He is sitting at a desk, looking pensively out the window. Modern office space with glass partitions and computer monitors. Soft blue-white fluorescent lighting from above, natural window light from the left creating gentle rim light. Contemplative mood. Cinematic 4K photorealistic, shallow depth of field, film grain."

  **Ví dụ SAI (thiếu chi tiết nhân vật):**
  "A man sitting at desk looking out window." ← KHÔNG ĐƯỢC, thiếu character_lock

  ### 5. REFERENCE FILE USAGE:

  Khi scene có nhân vật, field "reference_files" phải liệt kê ảnh reference cần dùng.
  Ví dụ: scene có nv1 và nv2 → reference_files: ["nv1.png", "nv2.png"]

  ### 6. SPATIAL POSITIONING (khi 2+ nhân vật):

  PHẢI mô tả vị trí cụ thể:
  - "In the foreground on the left: [character 1]. In the background on the right: [character 2]"
  - "Two people facing each other across a table"
  - "Three people standing in a row, from left to right: [char1], [char2], [char3]"

  ### 7. LIGHTING CONSISTENCY:

  Các scene trong cùng location phải có lighting tương tự (trừ khi time of day thay đổi).
  Sử dụng lighting_default từ location description.

  ---

  ## OUTPUT FORMAT - JSON:

  {{
    "scenes": [
      {{
        "scene_id": 1,
        "scene_type": "ESTABLISHING",
        "shot_type": "Wide Shot",
        "camera_angle": "Eye-level",
        "lens": "24mm wide angle",
        "location_id": "loc1",
        "characters_in_scene": ["nv1"],
        "reference_files": ["nv1.png"],

        "img_prompt": "Wide establishing shot, 24mm anamorphic lens. Interior of modern Vietnamese apartment living room. A 32-year-old Vietnamese man with short black side-parted hair, oval face, wearing navy polo shirt, standing by the large window looking out at the city. Beige sofa and wooden coffee table in foreground. Warm golden hour sunlight streaming through window, creating long shadows. Contemplative atmosphere. Cinematic 4K photorealistic, anamorphic lens flare, shallow depth of field with sharp focus on subject, film grain texture, 2.39:1 aspect ratio.",

        "video_prompt": "Slow dolly in from wide to medium shot. Camera gently moves forward, revealing more of the man's face. Dust particles float in the sunlight. Subtle movement of curtains. 4 seconds, smooth cinematic motion.",

        "technical_specs": {{
          "aspect_ratio": "2.39:1",
          "shot_type": "Wide Shot",
          "camera_angle": "Eye-level",
          "lens": "24mm",
          "movement": "Dolly in"
        }},

        "director_notes": "Opening shot - establish location and mood before dialogue begins",

        "negative_prompt": "cartoon, anime, wrong face, different hair, wrong clothing, multiple people when only one specified, blurry, dark shadows"
      }},
      {{
        "scene_id": 2,
        "scene_type": "DIALOGUE",
        "shot_type": "Over-the-shoulder",
        "camera_angle": "Eye-level",
        "lens": "50mm",
        "location_id": "loc1",
        "characters_in_scene": ["nv1", "nv2"],
        "reference_files": ["nv1.png", "nv2.png"],

        "img_prompt": "Over-the-shoulder shot from behind nv2, 50mm lens. In sharp focus: A 32-year-old Vietnamese man with short black side-parted hair, oval face, wearing navy polo shirt, sitting on beige sofa, speaking with engaged expression. In soft focus foreground: back of head and shoulder of a 30-year-old Vietnamese woman with long straight black hair. Living room setting with warm afternoon light from window on the left. Intimate conversational mood. Cinematic 4K photorealistic, shallow depth of field f/2.0, subject separation, film grain.",

        "video_prompt": "Static shot with subtle handheld drift. The man gestures while speaking, occasional glances away then back. Natural micro-movements. 5 seconds, documentary intimacy.",

        "technical_specs": {{
          "aspect_ratio": "2.39:1",
          "shot_type": "Over-the-shoulder",
          "camera_angle": "Eye-level",
          "lens": "50mm",
          "movement": "Static with drift"
        }},

        "director_notes": "Reverse shot follows - cut to nv2's reaction",

        "negative_prompt": "wrong characters, different hair color, different clothing, missing person, extra people"
      }}
    ]
  }}

  ## CHECKLIST TRƯỚC KHI OUTPUT:
  ✓ Mỗi scene có góc máy/shot type KHÁC với scene trước và sau?
  ✓ Character_lock được paste CHÍNH XÁC vào img_prompt?
  ✓ reference_files liệt kê đúng nhân vật trong scene?
  ✓ Location description consistent với locations đã định nghĩa?
  ✓ Không có 3+ scenes liên tiếp cùng shot type?

  Chỉ trả về JSON thuần, không markdown code block.

# =============================================================================
# PHẦN 4: NARRATOR SCENES (TALKING HEAD VARIATIONS)
# =============================================================================

generate_narrator_scenes: |
  Tạo 5 biến thể talking head cho nhân vật chính (narrator) với outfits và locations khác nhau.

  ## THÔNG TIN NHÂN VẬT:
  {main_character_info}

  ## YÊU CẦU:
  - 5 unique outfits
  - 5 unique indoor settings
  - Consistent character appearance (chỉ đổi quần áo và background)
  - Expression: Calm, engaging, storytelling

  ## OUTPUT: JSON với 5 narrator_scenes, mỗi scene có prompt đầy đủ.

# =============================================================================
# PHẦN 5: CAMERA & LENS REFERENCE
# =============================================================================

camera_reference:
  shot_types:
    "Extreme Wide Shot (EWS)": "Environment dominant, tiny subject - Establishing, scale"
    "Wide Shot (WS)": "Full body + environment - Establishing, movement"
    "Full Shot (FS)": "Full body, less environment - Introduction, action"
    "Medium Wide (MWS)": "Knees up - Walking, group shots"
    "Medium Shot (MS)": "Waist up - Standard dialogue, action"
    "Medium Close-up (MCU)": "Chest up - Dialogue, emotion"
    "Close-up (CU)": "Face fills frame - Emotion, reaction"
    "Extreme Close-up (ECU)": "Part of face/detail - Intensity, detail"
    "Over-the-shoulder (OTS)": "Behind one person looking at another - Conversation"
    "Two-shot": "Two people in frame - Relationship, dialogue"
    "POV": "Camera is character's eyes - Immersion"

  lenses:
    "14-24mm": "Ultra wide - Dramatic distortion, environments, vertigo"
    "24mm": "Wide - Establishing, environments with context"
    "35mm": "Wide normal - Full body, groups, natural perspective"
    "50mm": "Normal - Natural look, versatile, dialogue"
    "85mm": "Portrait - Beautiful bokeh, face detail, interviews"
    "100-135mm": "Telephoto - Compressed background, isolation, stalker POV"

  angles:
    "Eye-level": "Neutral, we are equal to character"
    "Low angle (looking up)": "Subject has power, heroic, threatening"
    "High angle (looking down)": "Subject is weak, vulnerable, trapped"
    "Dutch angle (tilted)": "Unease, disorientation, something wrong"
    "Bird's eye": "God view, seeing patterns, detachment"
    "Worm's eye": "Extreme low, monumental, child's POV"

  movements:
    "Static": "No movement - Stable, observational"
    "Pan": "Horizontal rotation - Following action, revealing space"
    "Tilt": "Vertical rotation - Revealing height, power dynamics"
    "Dolly in": "Moving toward - Increasing tension, focus"
    "Dolly out": "Moving away - Revealing, isolation, ending"
    "Tracking": "Following subject - Energy, immersion"
    "Crane": "Vertical + horizontal - Epic reveals, transitions"
    "Handheld": "Subtle shake - Documentary feel, urgency, intimacy"

# =============================================================================
# PHẦN 6: NEGATIVE PROMPTS LIBRARY
# =============================================================================

negative_prompts:
  character_scene: |
    wrong face, different character, inconsistent appearance,
    wrong hair color, wrong hair style, wrong clothing, wrong outfit,
    extra people, missing character, duplicate character,
    cartoon, anime, 3d render, illustration,
    bad anatomy, distorted face, mutation, deformed,
    blurry, low resolution, overexposed, underexposed,
    text, watermark, logo

  reference_portrait: |
    background elements, complex background, colored background,
    shadows on face, artistic lighting, dramatic lighting,
    expression other than neutral, looking away from camera,
    cartoon, anime, painting, illustration,
    blurry, low resolution, bad anatomy

  establishing_shot: |
    people not specified, wrong number of people,
    indoor when outdoor specified, outdoor when indoor specified,
    wrong time of day, wrong lighting,
    cartoon, anime, blurry, text, watermark

# =============================================================================
# PHẦN 7: TEST PROMPT
# =============================================================================

test_prompt: "beautiful sunset over ocean, golden hour, dramatic clouds, cinematic 4K"

# =============================================================================
# END OF CONFIGURATION v3.0
# =============================================================================
